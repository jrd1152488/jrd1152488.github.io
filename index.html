<!DOCTYPE html>
<html>

<head>
  <!-- CSS/JS -->
  <title>Web Map</title>

  <link rel="stylesheet" href="css/leaflet.css">
  <link rel="stylesheet" href="js/src/leaflet.draw.css">
  <link rel="stylesheet" href="css/leaflet-measure.css">
  <link rel="stylesheet" href="css/L.Control.Sidebar.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
  <link rel="stylesheet" href="css/leaflet-panel-layers.css">
  <!-- <link rel="stylesheet" href="css/leaflet-control-geocoder.Geocoder.css"> -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/leaflet-search.css">
  <link rel="stylesheet" href="css/search-control.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Condensed&display=swap">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css"
    integrity="sha512-YWzhKL2whUzgiheMoBFwW8CKV4qpHQAEuvilg9FAn5VJUDwKZZxkJNuGM4XkWuk94WCrrwslk8yWNGmY1EduTA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous">
  </script>
  <script src="js/leaflet.js"></script>
  <script src="js/leaflet-svg-shape-markers.min.js"></script>
  <script src="js/leaflet.rotatedMarker.js"></script>
  <script src="js/leaflet.pattern.js"></script>
  <script src="js/Autolinker.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.2/leaflet.draw.js"></script>
  <script src="js/leaflet-measure-path.js"></script>
  <script src="js/L.Control.Sidebar.js"></script>
  <script src="https://unpkg.com/leaflet-ajax@2.1.0/dist/leaflet.ajax.min.js"></script>
  <script src="js/leaflet-geotiff.js"></script>
  <script src="https://unpkg.com/geotiff@2.0.7/dist-browser/geotiff.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
  <!-- <script src="js/leaflet-control-geocoder.Geocoder.js"></script> -->
  <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
  <script src="js/leaflet-search.js"></script>
  <script src="js/leaflet-measure.js"></script>
  <script src="js/leaflet-panel-layers.js"></script>
  <script src="js/leaflet.wms.js"></script>

  <script src="js/leaflet-hash.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <script src="https://unpkg.com/togeojson@0.14.2"></script>

  <script src="js/L.KML.js"></script>
  <script src="js/rbush.min.js"></script>
  <script src="js/labelgun.min.js"></script>
  <script src="js/labels.js"></script>

  <script src="js/leaflet.filelayer.js"></script>
  <script src="https://unpkg.com/file-saver/dist/FileSaver.js"></script>

  <script src="js/src/Leaflet.Draw.Event.js"></script>
  <script src="js/src/Toolbar.js"></script>
  <script src="js/src/Tooltip.js"></script>

  <!-- Geoblaze -->
  <script src="https://unpkg.com/georaster"></script>
  <script src="https://unpkg.com/georaster-layer-for-leaflet"></script>
  <script src="https://unpkg.com/geoblaze"></script>
  <script src="https://unpkg.com/chroma-js@2.4.2/chroma.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
  <script src="https://unpkg.com/leaflet-geometryutil"></script>

  <!-- Bootstrap CSS -->

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
    integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
    integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous">
  </script>

  <!-- GeoJSON data -->
  <script src="data/ServiceContractMap_1.js"></script>
  <script src="data/AncestralDomain_3.js"></script>
  <script src="data/ProtectedAreas_4.js"></script>
  <!-- <script src="data/Liquefaction_South_7.js"></script>
  <script src="data/Liquefaction_North_8.js"></script> -->
  <script src="data/ActiveFault_13.js"></script>
  <script src="data/Seaports_14.js"></script>

  <script src="data/TaalBufferRings_1.js"></script>
  <script src="data/TaalFissuring_2.js"></script>
  <script src="data/TaalBallisticProjectiles_3.js"></script>
  <script src="data/PyroclasticFlow_4.js"></script>
  <script src="data/Lava_5.js"></script>
  <script src="data/Lahar_6.js"></script>
  <script src="data/Volcanoes_7.js"></script>
  <script src="data/ExistingTL_1.js"></script>
  <script src="data/TDPTL_2.js"></script>
  <script src="data/PlantCustomerownedSubstations_3.js"></script>
  <script src="data/69kVDULoadendSubstations_4.js"></script>
  <script src="data/500230138115kVExistingSubstations_5.js"></script>
  <script src="data/500230kVTDPSubstations_6.js"></script>

  <script src="data/BarangaysMin_1.js"></script>

  <!-- <script src="js/service_contracts.js"></script> -->
  <script src="js/service_contracts.js"></script>
  <script src="js/ancestral_domains.js"></script>
  <script src="js/protected_areas.js"></script>
  <script src="js/seaports.js"></script>
  <script src="js/protected_areas.js"></script>
  <script src="js/active_fault.js"></script>
  <script src="js/taal_hazards.js"></script>
  <script src="js/volcano.js"></script>
  <script src="js/lahar.js"></script>
  <script src="js/lava.js"></script>
  <script src="js/pyroclastic_flow.js"></script>
  <script src="js/barangay_layer.js"></script>
  <script src="js/plant_owned_substations.js"></script>
  <script src="js/existing_69_substations.js"></script>
  <script src="js/existing_230_substations.js"></script>
  <script src="js/tdp_substations.js"></script>
  <script src="js/existing_tl.js"></script>
  <script src="js/tdp_tl.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>

  </style>
</head>

<body>

  <div class="header-container">
    <div class="header">
      <div class="title">
        <div class="logo-container">
          <img src="AP Emblem.png" alt="AP Emblem" class="logo">
        </div>
        <div class="header-content">
          <span class="header-text"
            style="color: #f0f0f0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">ARI MARKET STRATEGY
            -
            SPT</span>
        </div>
      </div>
      <div class="search-bar">
        <div class="input-group">
          <select class="form-select" id="searchOption">
            <option selected>Select options</option>
            <option value="coordinates">Coordinates</option>
            <option value="location">Location</option>
            <option value="substation">Substation</option>
          </select>

          <form class="mb-auto" style="background-color: #164575;">
            <input type="search" class="form-control" id="searchInput" placeholder="Search...">
            <div id="suggestions"></div>
          </form>


          <div id="right-bar" class="right-bar">
            <button class="btn btn-outline-light me-2">Layers</button>
          </div>
        </div>


        <!-- <div class="dropdown"> -->
        <!-- <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown"
              aria-expanded="false">
              Search options
            </button>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#">Coordinates</a></li>
              <li><a class="dropdown-item" href="#">Location</a></li>
              <li><a class="dropdown-item" href="#">Substation</a></li>
            </ul> -->
        <!-- </div> -->


        <!-- <div id="right-bar" class="right-bar">
        <span></span>
        <span></span>
        <span></span>
      </div> -->
      </div>
    </div>
  </div>


  <!-- <div class="d-flex flex-column flex-shrink-0 p-3 bg-light" style="width: 280px;">
    <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-dark text-decoration-none">
      <svg class="bi me-2" width="40" height="32"><use xlink:href="#bootstrap"/></svg>
      <span class="fs-4">Sidebar</span>
    </a>
    <hr>
    <ul class="nav nav-pills flex-column mb-auto">
      <li class="nav-item">
        <a href="#" class="nav-link active" aria-current="page">
          <svg class="bi me-2" width="16" height="16"><use xlink:href="#home"/></svg>
          Home
        </a>
      </li>
      <li>
        <a href="#" class="nav-link link-dark">
          <svg class="bi me-2" width="16" height="16"><use xlink:href="#speedometer2"/></svg>
          Dashboard
        </a>
      </li>
      <li>
        <a href="#" class="nav-link link-dark">
          <svg class="bi me-2" width="16" height="16"><use xlink:href="#table"/></svg>
          Orders
        </a>
      </li>
      <li>
        <a href="#" class="nav-link link-dark">
          <svg class="bi me-2" width="16" height="16"><use xlink:href="#grid"/></svg>
          Products
        </a>
      </li>
      <li>
        <a href="#" class="nav-link link-dark">
          <svg class="bi me-2" width="16" height="16"><use xlink:href="#people-circle"/></svg>
          Customers
        </a>
      </li>
    </ul>
    <hr>
    <div class="dropdown">
      <a href="#" class="d-flex align-items-center link-dark text-decoration-none dropdown-toggle" id="dropdownUser2" data-bs-toggle="dropdown" aria-expanded="false">
        <img src="https://github.com/mdo.png" alt="" width="32" height="32" class="rounded-circle me-2">
        <strong>mdo</strong>
      </a>
      <ul class="dropdown-menu text-small shadow" aria-labelledby="dropdownUser2">
        <li><a class="dropdown-item" href="#">New project...</a></li>
        <li><a class="dropdown-item" href="#">Settings</a></li>
        <li><a class="dropdown-item" href="#">Profile</a></li>
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item" href="#">Sign out</a></li>
      </ul>
    </div>
  </div> -->


  <!-- <div id="right-menu">
    <div id="right-bar" class="right-bar">
      <i class="fas fa-bars"></i>
    </div>
  </div> -->

  <div id="settings-card" class="settings-card">
    <i class="fa-solid fa-cogs"></i>
  </div>


  <div id="floating-card" class="floating-card">
    <h1 class="sidebar-header common-header" style="margin-top: 10px;">
      <i class="fa-solid fa-calculator sbheader-icon"></i>
      <span class="sbheader-text">Layer Selection</span>
    </h1>
    <div class="d-flex flex-column" style="margin-bottom: 5px;">

      <div class="form-check">
        <input class="form-check-input" type="radio" name="mapLayer" id="googSat" autocomplete="off"
          onchange="toggleLayer('layer_GoogleMapsSatellite_1', this.checked)" checked>
        <label class="form-check-label" for="googSat">Satellite</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="mapLayer" id="googHySat" autocomplete="off"
          onchange="toggleLayer('layer_GoogleSatelliteHybrid_1', this.checked)">
        <label class="form-check-label" for="googHySat">Hybrid Satellite</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="mapLayer" id="GoogBase" autocomplete="off"
          onchange="toggleLayer('layer_GoogleMapsBasic_0', this.checked)">
        <label class="form-check-label" for="GoogBase">Base Map</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="mapLayer" id="planetNICFI" autocomplete="off"
          onchange="toggleLayer('layer_planetNICFI', this.checked)">
        <label class="form-check-label" for="planetNICFI">Live Satellite (April 2023)</label>
      </div>
    </div>

    <hr class="sidebar-spacer">

    <div class="d-flex justify-content-center align-items-center" style="margin-bottom: 5px;">
      <div class="row">
        <div class="col-md-12">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="toggleCheckbox">
            <label class="form-check-label" for="toggleCheckbox">Irradiance Map</label>
          </div>
        </div>
        <div class="col-md-12">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="WStoggleCheckbox">
            <label class="form-check-label" for="WStoggleCheckbox">Wind Speed Map</label>
          </div>
        </div>
        <div class="col-md-12">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="SLPtoggleCheckbox">
            <label class="form-check-label" for="SLPtoggleCheckbox">Slope Map</label>
          </div>
        </div>
      </div>
    </div>

    <hr class="sidebar-spacer">


    <!-- Tile Layers -->
    <h1 class="sidebar-header common-header" style="margin-bottom: 10px; margin-top: 20px;">
      <i class="fa-solid fa-tiles sbheader-icon"></i>
      <span class="sbheader-text">Tile Layers</span>
    </h1>
    <div class="group-container">
      <div class="group-checkbox">
        <input class="form-check-input" type="checkbox" id="group1" onchange="toggleMainNest(this, 'group1')">
        <label class="form-check-label" for="group1">Solar Suitability</label>
      </div>
      <div class="nested-checkboxes">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-GHISLP"
            onchange="toggleTileLayer(layer_GHISLP, this.checked)">
          <label class="form-check-label" for="chk-GHISLP">GHI x Slope</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-IRDGHI"
            onchange="toggleTileLayer(layer_IRDGHI, this.checked)">
          <label class="form-check-label" for="chk-IRDGHI">Solar Irradiance, kWh/mÂ²</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-SLPSLR"
            onchange="toggleTileLayer(layer_SLPSLR, this.checked)">
          <label class="form-check-label" for="chk-SLPSLR">Slope Caps - Solar</label>
        </div>
      </div>
    </div>

    <div class="group-container">
      <div class="group-checkbox">
        <input class="form-check-input" type="checkbox" id="group1" onchange="toggleMainNest(this, 'group1')">
        <label class="form-check-label" for="group1">Wind Suitability</label>
      </div>
      <div class="nested-checkboxes">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-WSSLP"
            onchange="toggleTileLayer(layer_WSSLP, this.checked)">
          <label class="form-check-label" for="chk-WSSLP">Wind x Slope</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-WS"
            onchange="toggleTileLayer(layer_WS, this.checked)">
          <label class="form-check-label" for="chk-WS">Wind Speed, m/s</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-SLPWD"
            onchange="toggleTileLayer(layer_SLPWD, this.checked)">
          <label class="form-check-label" for="chk-SLPWD">Slope Caps - Wind</label>
        </div>
      </div>
    </div>

    <div class="group-container">
      <div class="group-checkbox">
        <input class="form-check-input" type="checkbox" id="group1" onchange="toggleMainNest(this, 'group1')">
        <label class="form-check-label" for="group1">Slope Industry</label>
      </div>
      <div class="nested-checkboxes">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-SLP"
            onchange="toggleTileLayer(layer_SLP, this.checked)">
          <label class="form-check-label" for="chk-SLP">Slope</label>
        </div>
      </div>
    </div>

    <div class="group-container">
      <div class="group-checkbox">
        <input class="form-check-input" type="checkbox" id="group4" onchange="toggleGroup(this, 'group4')">
        <label class="form-check-label" for="group4">Area Restrictions</label>
      </div>
      <div class="nested-checkboxes ml-3">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-ServiceContractMap_1"
            onchange="toggleTileLayer(layer_ServiceContractMap_1, this.checked)">
          <label class="form-check-label" for="chk-ServiceContractMap_1">Service Contract Map</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-AncestralDomain_3"
            onchange="toggleTileLayer(layer_AncestralDomain_3, this.checked)">
          <label class="form-check-label" for="chk-AncestralDomain_3">Ancestral Domains</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-ProtectedAreas_4"
            onchange="toggleTileLayer(layer_ProtectedAreas_4, this.checked)">
          <label class="form-check-label" for="chk-ProtectedAreas_4">Protected Areas</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-KeyBiodiversityAreas_5"
            onchange="toggleTileLayer(layer_KeyBiodiversityAreas_5, this.checked)">
          <label class="form-check-label" for="chk-KeyBiodiversityAreas_5">Key Biodiversity Areas</label>
        </div>
      </div>
    </div>

    <div class="group-container">
      <div class="group-checkbox">
        <input class="form-check-input" type="checkbox" id="group4" onchange="toggleGroup(this, 'group4')">
        <label class="form-check-label" for="group4">Area Restrictions</label>
      </div>
      <div class="nested-checkboxes ml-3">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-RVRWBS" onchange="toggleNestedCheckbox(this);">
          <label class="form-check-label" for="chk-RVRWBS">River and Water Bodies</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-FloodHazard_25yrs_6"
            onchange="toggleNestedCheckbox(this);">
          <label class="form-check-label" for="chk-FloodHazard_25yrs_6">Flood Hazard</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-LQFCN" onchange="toggleNestedCheckbox(this);">
          <label class="form-check-label" for="chk-LQFCN">Liquefaction</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-ActiveFault_13"
            onchange="toggleNestedCheckbox(this);">
          <label class="form-check-label" for="chk-ActiveFault_13">Active Fault</label>
        </div>
      </div>
    </div>

    <div class="group-container">
      <div class="group-checkbox">
        <input class="form-check-input" type="checkbox" id="group5" onchange="toggleGroup(this, 'group5')">
        <label class="form-check-label" for="group5">Hazards - Volcano</label>
      </div>
      <div class="nested-checkboxes ml-3">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-Volcanoes_7" onchange="toggleNestedCheckbox(this);">
          <label class="form-check-label" for="chk-Volcanoes_7">Active Volcano</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-Lahar_6" onchange="toggleNestedCheckbox(this);">
          <label class="form-check-label" for="chk-Lahar_6">Lahar</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-Lava_5" onchange="toggleNestedCheckbox(this);">
          <label class="form-check-label" for="chk-Lava_5">Lava</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-PyroclasticFlow_4"
            onchange="toggleNestedCheckbox(this);">
          <label class="form-check-label" for="chk-PyroclasticFlow_4">Pyroclastic Flow</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-TaalBallisticProjectiles_3"
            onchange="toggleNestedCheckbox(this);">
          <label class="form-check-label" for="chk-TaalBallisticProjectiles_3">Taal Ballistic
            Projectiles</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-TaalFissuring_2"
            onchange="toggleNestedCheckbox(this);">
          <label class="form-check-label" for="chk-TaalFissuring_2">Taal Fissuring</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-TaalBufferRings_1"
            onchange="toggleNestedCheckbox(this);">
          <label class="form-check-label" for="chk-TaalBufferRings_1">Taal Buffer Rings</label>
        </div>
      </div>
    </div>

    <div class="group-container">
      <div class="group-checkbox">
        <input class="form-check-input" type="checkbox" id="group6" onchange="toggleGroup(this, 'group6')">
        <label class="form-check-label" for="group6">Others</label>
      </div>
      <div class="nested-checkboxes ml-3">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-Seaports_14" onchange="toggleNestedCheckbox(this);">
          <label class="form-check-label" for="chk-Seaports_14">Seaports</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-RDS" onchange="toggleNestedCheckbox(this);">
          <label class="form-check-label" for="chk-RDS">Roads</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-BarangaysMin_1"
            onchange="toggleNestedCheckbox(this);">
          <label class="form-check-label" for="chk-BarangaysMin_1">Barangay</label>
        </div>
      </div>
    </div>

    <div class="group-container">
      <div class="group-checkbox">
        <input class="form-check-input" type="checkbox" id="group7" onchange="toggleGroup(this, 'group7')">
        <label class="form-check-label" for="group7">Substations and Lines</label>
      </div>
      <div class="nested-checkboxes ml-3">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-ExistingTL_1" onchange="toggleNestedCheckbox(this);">
          <label class="form-check-label" for="chk-ExistingTL_1">Existing Transmission Lines</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-TDPTL_2" onchange="toggleNestedCheckbox(this);">
          <label class="form-check-label" for="chk-TDPTL_2">Transmission and Distribution Lines</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-PlantCustomerownedSubstations_3"
            onchange="toggleNestedCheckbox(this);">
          <label class="form-check-label" for="chk-PlantCustomerownedSubstations_3">Plant Customer-owned
            Substations</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-69kVDULoadendSubstations_4"
            onchange="toggleNestedCheckbox(this);">
          <label class="form-check-label" for="chk-69kVDULoadendSubstations_4">69kV Distribution Utility
            Load-end Substations</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-500230138115kVExistingSubstations_5"
            onchange="toggleNestedCheckbox(this);">
          <label class="form-check-label" for="chk-500230138115kVExistingSubstations_5">500/230/138/11kV
            Existing Substations</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chk-500230kVTDPSubstations_6"
            onchange="toggleNestedCheckbox(this);">
          <label class="form-check-label" for="chk-500230kVTDPSubstations_6">500/230kV TDP Substations</label>
        </div>
      </div>
    </div>
  </div>

  <div id="sidebar-three" class="sidebar-three">
    <!-- <div class="container"> -->
    <div class="container custom-scrollbar">
      <h1 class="sidebar-header common-header">
        <i class="fa-solid fa-calculator sbheader-icon"></i>
        <span class="sbheader-text">Layer Select</span>
        <!-- <span class="sidebar-close"></span> -->
      </h1>
      <!-- Add additional content here -->
    </div>
  </div>
  </div>


  <div id="sidebar-calc" class="sidebar-calc" style="padding: 2px; width: 400px;">
    <div class="container">
      <div class="container custom-scrollbar">
        <div class="sidebar-tabs">
          <div class="sidebar-pane" id="geotiff">

            <!-- Raster Calculator -->
            <div class="sidebar-pane" id="geotiff">
              <h1 class="sidebar-header common-header" style="margin-bottom: 20px; margin-top: 30px;">
                <i class="fa-solid fa-calculator sbheader-icon"></i>
                <span class="sbheader-text">Suitability Calculator</span>
              </h1>

              <div style="display: flex; justify-content: space-between;">
                <div>
                  <input type="file" id="fileInput" accept=".geojson" multiple style="display: none;"
                    onchange="displayFileName()">
                  <label for="fileInput" style="margin-bottom: 10px;" class="btn btn-primary btn-sm">Upload
                    Shapefile</label>
                </div>
                <div>
                  <button id="fetchButton" class="btn btn-primary btn-sm">Calculate
                    Stats</button>
                </div>
              </div>
              <strong>Assessed Area: </strong><span id="fileName"></span>

              <body onload="runSequentially()">
                <pre id="output"></pre>
                <div id="loading-prompt" class="loading-prompt" style="display: none; margin-top: 10px">
                  <div class="loading-bar"></div>
                </div>
                <div style="display: flex; justify-content: center; align-items: center;">
                  <div class="card" style="width: 24rem;">
                    <ul class="list-group list-group-flush">
                      <li class="list-group-item">
                        <p><i class="fa-regular fa-sun custom-icon"></i>
                          <span class="custom-heading">Irradiance:</span>
                        </p>
                        <span id="GHIstatisticss" class="custom-text"></span>
                      </li>
                      <li class="list-group-item">
                        <p><i class="fa-solid fa-wind custom-icon"></i>
                          <span class="custom-heading">Wind
                            Speed:</span>
                        </p>
                        <span id="WSstatisticss" class="custom-text"></span>
                      </li>
                      <li class="list-group-item">
                        <p><i class="fa-solid fa-mountain custom-icon"></i>
                          <span class="custom-heading">Slope:</span>
                        </p>
                        <span id="SLPstatisticss" class="custom-text"></span>
                      </li>
                      <li class="list-group-item">
                        <p><i class="fa-solid fa-compass custom-icon"></i>
                          <span class="custom-heading">Azimuth:</span>
                        </p>
                        <span id="Azmtstatisticss" class="custom-text"></span>
                      </li>
                      <li class="list-group-item">
                        <p><i class="fa-solid fa-file-contract custom-icon"></i>
                          <span class="custom-heading">Service
                            Contract:</span></p>
                        <span id="SCstatisticss" class="custom-text"></span>
                      </li>
                      <li class="list-group-item">
                        <p><i class="fa-solid fa-earth-asia custom-icon"></i>
                          <span class="custom-heading">Ancestral
                            Domains:</span></p>
                        <span id="ADstatisticss" class="custom-text"></span>
                      </li>
                      <li class="list-group-item">
                        <p><i class="fa-solid fa-water custom-icon"></i>
                          <span class="custom-heading">Irrigated
                            Land:</span></p>
                        <span id="Irgtnstatisticss" class="custom-text"></span>
                      </li>
                      <li class="list-group-item">
                        <p><i class="fa-solid fa-kiwi-bird custom-icon"></i>
                          <span class="custom-heading">Protected
                            Areas:</span></p>
                        <span id="PrtdArsstatisticss" class="custom-text"></span>
                      </li>
                      <li class="list-group-item">
                        <p><i class="fa-solid fa-house-crack custom-icon"></i>
                          <span class="custom-heading">Active
                            Fault:</span></p>
                        <span id="Fltstatisticss" class="custom-text"></span>
                      </li>
                      <li class="list-group-item">
                        <p><i class="fa-solid fa-triangle-exclamation custom-icon"></i>
                          <span class="custom-heading">Floods:</span></p>
                        <span id="FldBistatisticss" class="custom-text"></span>
                      </li>
                    </ul>
                  </div>
                </div>
                <!-- Histogram -->
                </br><strong>Histogram Results: </strong>
                <div class="card text-center">
                  <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs justify-content-center"
                      style="font-size: smaller; padding: 1px;">
                      <li class="nav-item">
                        <a class="nav-link active" aria-current="true" href="#solarslopeTab"
                          data-bs-toggle="tab">SLRxSLP</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="#windslopeTab" data-bs-toggle="tab">WNDxSLP</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="#solarTab" data-bs-toggle="tab">SLR</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="#windTab" data-bs-toggle="tab">WND</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="#slopeTab" data-bs-toggle="tab">SLP</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="#liquefactionTab" data-bs-toggle="tab">LIQ</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="#floodTab" data-bs-toggle="tab">FLD</a>
                      </li>
                    </ul>
                  </div>
                  <div class="card-body">
                    <div class="tab-content">
                      <div class="tab-pane fade show active" id="solarslopeTab">
                        <!-- SolarxSlope content -->
                        <!-- Add your content here -->
                      </div>
                      <div class="tab-pane fade" id="windslopeTab">
                        <!-- WindxSlope content -->
                        <!-- Add your content here -->
                      </div>
                      <div class="tab-pane fade" id="solarTab">
                        <!-- Solar content -->
                        <!-- Add your content here -->
                      </div>
                      <div class="tab-pane fade" id="windTab">
                        <!-- Wind content -->
                        <!-- Add your content here -->
                      </div>
                      <div class="tab-pane fade" id="slopeTab">
                        <canvas id="histogramChart"></canvas>
                      </div>
                      <div class="tab-pane fade" id="liquefactionTab">
                        <!-- Liquefaction content -->
                        <!-- Add your content here -->
                      </div>
                      <div class="tab-pane fade" id="floodTab">
                        <!-- Flood content -->
                        <!-- Add your content here -->
                      </div>
                    </div>
                  </div>
                </div>
            </div>
          </div>
          </br>
          <div style="display: flex; justify-content: center; align-items: center;">
            <button id="clearResultsBtn" class="btn btn-warning btn-sm">Clear
              Results</button>
          </div>

        </div>

        <hr class="sidebar-spacer">

        <div class="sidebar-pane" id="calculator" style="margin-top: 30px;">
          <h1 class="sidebar-header common-header">
            <i class="fa-solid fa-database sbheader-icon"></i>
            <span class="sbheader-text">HLA Calculator</span>
          </h1>
          <div>
            <div>
              <table class="table">
                <tr>
                  <td><label for="ghi">GHI Mean Irradiance, kWh/sqm:</label></td>
                  <td><input type="number" id="ghi" name="ghi" step="any" class="form-control"></td>
                </tr>
                <tr>
                  <td><label for="slope">Mean Slope, Percent:</label></td>
                  <td><input type="number" id="slope" name="slope" step="any" class="form-control"></td>
                </tr>
                <tr>
                  <td><label for="tl_distance">TL Distance (x 1.1):</label></td>
                  <td><input type="number" id="tl_distance" name="tl_distance" step="any" class="form-control">
                  </td>
                </tr>
                <tr>
                  <td><label for="purchase_price">Purchase Price
                      (Net/sqm):</label></td>
                  <td><input type="number" id="purchase_price" name="purchase_price" step="any" class="form-control">
                  </td>
                </tr>
                <tr>
                  <td><label for="total_area">Total Area in Ha:</label></td>
                  <td><input type="number" id="total_area" name="total_area" step="any" class="form-control"></td>
                </tr>

                <tr>
                  <td colspan="2" style="text-align:center; padding: 10px 0;">
                    <button onclick="calculate()" class="btn btn-primary">Calculate</button></td>
                </tr>

                <tr>
                  <td><label for="result">Result:</label></td>


                  <td><input type="number" id="result" name="result" readonly class="form-control"></td>
                </tr>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="content">
    <div id="map" style="width: 100%; height: 100%;">

      <div id="sidemenu">
        <!-- <div id="suitability" class="suitability">
          <button class="sidemenu-btn btn-secondary sidemenu-button">
            <i class="fas fa-chart-line"></i>
          </button>
        </div>
        <div id="three" class="three">
          <button class="sidemenu-btn btn-light sidemenu-button">
            <i class="fas fa-cog"></i>
          </button>
        </div>

        <hr class="sidebar-spacer">

        <button id="uploadButton" class="sidemenu-btn btn-light sidemenu-button">
          <i class="fas fa-file-import"></i>
        </button>

        <button id="deleteAllButton" class="sidemenu-btn btn-light sidemenu-button">
          <i class="fas fa-trash"></i>
        </button>

        <button id="exportButton" class="sidemenu-btn btn-light sidemenu-button">
          <i class="fas fa-download"></i>
        </button> -->
      </div>




    </div>
    <div id="drawContainer"></div>
    <div id="deleteAllContainer"></div>

    <div id="map-container">
      <div id="polygon-layer" class="leaflet-pane leaflet-overlay-pane">

      </div>
    </div>

    <div id="map">

    </div>



    <script>
      //SPT
      var highlightLayer;

      function highlightFeature(e) {
        highlightLayer = e.target;
        if (e.target.feature.geometry.type === 'LineString') {
          highlightLayer.setStyle({
            color: '#ffff00',
          });
        } else {
          highlightLayer.setStyle({
            fillColor: '#ffff00',
            fillOpacity: 1
          });
        }
      }
      var map = L.map('map', {
        zoomControl: false,
        maxZoom: 28,
        minZoom: 1
      });

      var philippines = L.latLng(12.8797, 121.7740);
      map.setView(philippines, 6);

      // Start of Universal Search
      var searchInput = document.getElementById('searchInput');
      var searchOption = document.getElementById('searchOption');
      var form = document.querySelector('form');
      var suggestionsDiv = document.getElementById('suggestions');
      var geocoder;
      var marker;
      var suggestionsShown = false; // Flag to track if suggestions are shown

      form.addEventListener('submit', function (event) {
        event.preventDefault();

        if (searchOption.value === 'location') {
          searchLocationByAddress(map, searchInput.value);
        } else if (searchOption.value === 'coordinates') {
          console.log('Coordinates search selected');
        } else if (searchOption.value === 'substation') {
          console.log('Substation search selected');
        }
      });

      // Geocoder - Location
      geocoder = L.Control.Geocoder.nominatim();
      searchInput.addEventListener('input', function (event) {
        var query = event.target.value;
        if (query.length > 2 && searchOption.value === 'location' && !suggestionsShown) {
          geocoder.geocode(query, function (results) {
            showSuggestions(results);
          });
        } else if (query.length === 0) {
          clearSuggestions();
        }
      });

      // Event listener for the coordinates input
      document.getElementById('searchInput').addEventListener('input', function (event) {
        if (searchOption.value === 'coordinates') {
          var coordinates = event.target.value.split(',');
          if (coordinates.length !== 2) {
            // Clear the marker if coordinates are not in the correct format
            if (marker) {
              map.removeLayer(marker);
              marker = null;
            }
            return;
          }

          var latitude = parseFloat(coordinates[0].trim());
          var longitude = parseFloat(coordinates[1].trim());

          if (isNaN(latitude) || isNaN(longitude)) {
            // Clear the marker if coordinates are not valid numbers
            if (marker) {
              map.removeLayer(marker);
              marker = null;
            }
            return;
          }

          var latLng = L.latLng(latitude, longitude);
          marker = L.marker(latLng).addTo(map);
          if (marker) {
            marker.setLatLng(latLng);
            displayPopup(latLng, coordinates);
          } else {
            marker = L.marker(latLng).addTo(map);
            displayPopup(latLng, coordinates);
          }
          map.setView(latLng, 16);
          displayPopup(latLng, coordinates);

          console.log('Coordinates search selected');
        }
      });

      function searchLocationByAddress(map, query) {
        // Clear any existing markers on the map
        map.eachLayer(function (layer) {
          if (layer instanceof L.Marker) {
            map.removeLayer(layer);
          }
        });
        // Use the geocoder to get the location coordinates
        geocoder.geocode(query, function (results) {
          if (results.length > 0) {
            var location = results[0].center;
            marker = L.marker(location).addTo(map);
            map.setView(location, 16);
            displayPopup(location, results[0].name);
          } else {
            console.log('No results found');
          }
        });
      }

      // Show suggested list based on location search
      function showSuggestions(results) {
        clearSuggestions();
        if (results.length > 0) {
          var div = document.createElement('div');
          div.classList.add('card');
          results.forEach(function (result) {
            var suggestionItem = document.createElement('div');
            suggestionItem.classList.add('suggestion-item');
            suggestionItem.textContent = result.name;
            suggestionItem.addEventListener('click', function () {
              searchInput.value = result.name;
              clearSuggestions();
              searchLocationByAddress(map, result.name);
            });
            div.appendChild(suggestionItem);
          });
          suggestionsDiv.appendChild(div);
          suggestionsShown = true; // Set suggestions shown flag
        }
      }

      function clearSuggestions() {
        suggestionsDiv.innerHTML = '';
        suggestionsShown = false; // Reset suggestions shown flag
      }

      function displayPopup(latLng, content) {
        var popupContent = '<b>' + (searchOption.value === 'location' ? 'Location' : 'Coordinates') + ':</b><br>' +
          content;
        marker.bindPopup(popupContent).openPopup();
      }

      // End of Universal Search



      // Sidebar easybutton
      L.easyButton({
        states: [{
          stateName: 'toggle-sidebar',
          icon: 'fa-bars',
          title: 'Toggle Sidebar',
          onClick: function (control) {
            var sidebar = document.getElementById('sidebar-calc');
            sidebar.classList.toggle('open');
          }
        }]
      }).addTo(map);




      // Create the settings-card EasyButton
      L.easyButton({
        id: 'settings-button',
        states: [{
          stateName: 'toggle-settings',
          icon: 'fa-cogs',
          title: 'Toggle Settings',
          onClick: function (control) {
            var sidebar = document.getElementById('sidebar-three');
            sidebar.classList.toggle('open');
          }
        }]
      }).addTo(map);

      var easyButtonElement = document.querySelector('#settings-button.leaflet-bar');
      if (easyButtonElement) {
        easyButtonElement.style.position = 'absolute';
        easyButtonElement.style.top = '800px'; // Adjust the top position in pixels
        easyButtonElement.style.left = '600px'; // Adjust the left position in pixels
      }




















      var fileUploaders = new L.FeatureGroup();
      map.addLayer(fileUploaders);

      var autolinker = new Autolinker({
        truncate: {
          length: 30,
          location: 'smart'
        }
      });

      // Function to toggle the nested layers
      function toggleNestedLayers(collapseId, checked) {
        var layers = document.getElementById(collapseId).querySelectorAll('input[type="checkbox"]');
        for (var i = 0; i < layers.length; i++) {
          layers[i].checked = checked;
          toggleLayer(layers[i].id, checked);
        }
      }

      // Function to toggle individual layers
      function toggleLayer(layerId, checked) {}

      function toggleButton(buttonId) {
        var button = document.getElementById(buttonId);
        button.classList.toggle("active");
      }

      // Floating Card
      document.getElementById('right-bar').addEventListener('click', function () {
        this.classList.toggle('open');
        toggleSidebar();
      });

      function toggleSidebar() {
        var floatingCard = document.getElementById('floating-card');
        floatingCard.classList.toggle('active');

        var rightBar = document.getElementById('right-bar');
        rightBar.classList.toggle('active');
      }


      // End of Floating Card

      // Clear Sidebar Values

      document.getElementById('clearResultsBtn').addEventListener('click', function () {
        // Clear the values of the Raster Calculator and the Histogram here
        var rasterCalculatorInput = document.getElementById('rasterCalculatorInput');
        var fileName = document.getElementById('fileName');
        if (rasterCalculatorInput) {
          rasterCalculatorInput.value = '';
        }
        if (fileName) {
          fileName.value = '';
        }

        // Clear the values of the Histogram results here
        var GHIstatisticss = document.getElementById('GHIstatisticss');
        var WSstatisticss = document.getElementById('WSstatisticss');
        var SLPstatisticss = document.getElementById('SLPstatisticss');
        var Azmtstatisticss = document.getElementById('Azmtstatisticss');
        var SCstatisticss = document.getElementById('SCstatisticss');
        var ADstatisticss = document.getElementById('ADstatisticss');
        var Irgtnstatisticss = document.getElementById('Irgtnstatisticss');
        var PrtdArsstatisticss = document.getElementById('PrtdArsstatisticss');
        var Fltstatisticss = document.getElementById('Fltstatisticss');
        var FldBistatisticss = document.getElementById('FldBistatisticss');

        if (GHIstatisticss) {
          GHIstatisticss.textContent = '';
        }
        if (WSstatisticss) {
          WSstatisticss.textContent = '';
        }
        if (SLPstatisticss) {
          SLPstatisticss.textContent = '';
        }
        if (Azmtstatisticss) {
          Azmtstatisticss.textContent = '';
        }
        if (SCstatisticss) {
          SCstatisticss.textContent = '';
        }
        if (ADstatisticss) {
          ADstatisticss.textContent = '';
        }
        if (Irgtnstatisticss) {
          Irgtnstatisticss.textContent = '';
        }
        if (PrtdArsstatisticss) {
          PrtdArsstatisticss.textContent = '';
        }
        if (Fltstatisticss) {
          Fltstatisticss.textContent = '';
        }
        if (FldBistatisticss) {
          FldBistatisticss.textContent = '';
        }
        if (fileName) {
          fileName.textContent = '';
        }


        // Clear the histogram chart
        var histogramChart = document.getElementById('histogramChart');
        if (histogramChart) {
          // Get the existing chart instance
          var existingChart = Chart.getChart(histogramChart);

          if (existingChart) {
            // Destroy the existing chart instance
            existingChart.destroy();
          }

          // Clear the canvas
          var ctx = histogramChart.getContext('2d');
          ctx.clearRect(0, 0, histogramChart.width, histogramChart.height);
        }
      });

      var bounds_group = new L.featureGroup([]);

      function setBounds() {}

      map.createPane('pane_GoogleMapsBasic_0');
      map.getPane('pane_GoogleMapsBasic_0').style.zIndex = 100;
      var layer_GoogleMapsBasic_0 = L.tileLayer('https://mt0.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
        pane: 'pane_GoogleMapsBasic_0',
        opacity: 0.671,
        minZoom: 1,
        maxZoom: 28,
        minNativeZoom: 0,
        maxNativeZoom: 18
      });
      layer_GoogleMapsBasic_0;

      map.createPane('pane_GoogleMapsSatellite_1');
      map.getPane('pane_GoogleMapsSatellite_1').style.zIndex = 100;
      var layer_GoogleMapsSatellite_1 = L.tileLayer('http://mt0.google.com/vt/lyrs=s&hl=en&x={x}&y={y}&z={z}', {
        pane: 'pane_GoogleMapsSatellite_1',
        opacity: 1.0,
        minZoom: 1,
        maxZoom: 28,
        minNativeZoom: 0,
        maxNativeZoom: 25
      });
      layer_GoogleMapsSatellite_1;

      map.createPane('pane_GoogleSatelliteHybrid_1');
      map.getPane('pane_GoogleSatelliteHybrid_1').style.zIndex = 100;
      var layer_GoogleSatelliteHybrid_1 = L.tileLayer('https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}', {
        pane: 'pane_GoogleSatelliteHybrid_1',
        opacity: 1.0,
        minZoom: 1,
        maxZoom: 28,
        minNativeZoom: 0,
        maxNativeZoom: 25
      });
      layer_GoogleSatelliteHybrid_1;

      map.createPane('pane_planetNICFI');
      map.getPane('pane_planetNICFI').style.zIndex = 100;
      var layer_planetNICFI = L.tileLayer(
        'https://tiles.planet.com/basemaps/v1/planet-tiles/planet_medres_visual_2023-04_mosaic/gmap/{z}/{x}/{y}.png?api_key=PLAK157598af286b421386a7fa8a69f90b85', {
          pane: 'pane_planetNICFI',
          opacity: 1.0,
          minZoom: 1,
          maxZoom: 28,
          minNativeZoom: 0,
          maxNativeZoom: 25
        });
      layer_planetNICFI;

      map.addLayer(layer_GoogleMapsSatellite_1); // Add Google Satellite as the default layer

      function toggleLayer(layerName, checked) {
        if (checked) {
          // Remove all other layers
          map.eachLayer(function (layer) {
            if (layer.options.pane !== layerName) {
              map.removeLayer(layer);
            }
          });
          // Add the selected layer
          map.addLayer(eval(layerName));
        } else {
          // Remove the selected layer
          map.removeLayer(eval(layerName));
        }
      }

      toggleLayer('layer_GoogleMapsSatellite_1', true);
      toggleLayer('layer_GoogleSatelliteHybrid_1', false);
      toggleLayer('layer_GoogleMapsBasic_0', false);
      toggleLayer('layer_planetNICFI', false);


      function createTileLayer(name, url) {
        map.createPane(`pane_${name}`);
        map.getPane(`pane_${name}`).style.zIndex = 101;
        const layer = L.tileLayer(url, {
          pane: `pane_${name}`,
          opacity: 1,
          attribution: '',
          minZoom: 1,
          maxZoom: 28,
          minNativeZoom: 4,
          maxNativeZoom: 14
        });
        return layer;
      }

      const layer_GHISLP = createTileLayer('GHISLP',
        'https://github.com/czrxstrd4/GHISLP/raw/main/GHISLP/{z}/{x}/{y}.png');
      const layer_IRDGHI = createTileLayer('IRDGHI',
        'https://github.com/czrxstrd4/IRDGHI/raw/main/IRDGHI/{z}/{x}/{y}.png');
      const layer_SLPSLR = createTileLayer('SLPSLR',
        'https://github.com/czrxstrd4/SLPSLR/raw/main/SLPSLR/{z}/{x}/{y}.png');
      const layer_WSSLP = createTileLayer('WSSLP',
        'https://github.com/czrxstrd4/WSSLP/raw/main/WSSLP/{z}/{x}/{y}.png');
      const layer_WS = createTileLayer('WS', 'https://github.com/czrxstrd4/WS/raw/main/WS/{z}/{x}/{y}.png');
      const layer_SLPWD = createTileLayer('SLPWD',
        'https://github.com/czrxstrd4/SLPWD/raw/main/SLPWD/{z}/{x}/{y}.png');
      const layer_SLP = createTileLayer('SLP', 'https://github.com/czrxstrd4/SLP/raw/main/SLP/{z}/{x}/{y}.png');

      function toggleTileLayer(layer, checked) {
        if (checked) {
          map.addLayer(layer);
        } else {
          map.removeLayer(layer);
        }
      }

      function toggleGroup(checkbox, groupId) {
        var nestedCheckboxes = document.querySelectorAll(`#${groupId} .nested-checkboxes input[type='checkbox']`);
        var isChecked = checkbox.checked;

        nestedCheckboxes.forEach(function (nestedCheckbox) {
          nestedCheckbox.checked = isChecked;
          toggleNestedCheckbox(nestedCheckbox);
        });
      }

      function toggleNestedCheckbox(nestedCheckbox) {
        var layerId = nestedCheckbox.id.replace("chk-", "layer_");
        var layer = window[layerId];

        if (layer) {
          toggleTileLayer(layer, nestedCheckbox.checked);
        }
      }

      function toggleMainNest(checkbox, groupId) {
        var mainNestCheckbox = document.getElementById(groupId);
        var nestedCheckboxes = document.querySelectorAll(`#${groupId} .nested-checkboxes input[type='checkbox']`);
        var isChecked = checkbox.checked;

        nestedCheckboxes.forEach(function (nestedCheckbox) {
          nestedCheckbox.checked = isChecked;
          toggleNestedCheckbox(nestedCheckbox);
        });

        mainNestCheckbox.checked = isChecked && nestedCheckboxes.length > 0 && nestedCheckboxes.length ===
          document
          .querySelectorAll(`#${groupId} .nested-checkboxes input[type='checkbox']:checked`).length;
      }

      var overLayers = {
        "GHISLP": layer_GHISLP,
        "IRDGHI": layer_IRDGHI,
        "SLPSLR": layer_SLPSLR,
        "WSSLP": layer_WSSLP,
        "WS": layer_WS,
        "SLPWD": layer_SLPWD,
        "SLP": layer_SLP
      };

      // var sidebar = L.control.sidebar('sidebar').addTo(map);
      var drawnItems = new L.FeatureGroup().addTo(map);

      //Hash-Autolinker
      var hash = new L.Hash(map);
      map.attributionControl.setPrefix(
        '<a href="https://docs.google.com/presentation/d/1axuiZhPorCGUERwNVxPLmkL-y0abwjHQ74vIZsYIFpg/edit?usp=sharing" title="Step by Step Guide of the SPT Process"target="_blank">Guide</a> &middot; Developed by: <a href="https://ph.linkedin.com/in/cezar-john-estrada-5a6a31105" title="Developer"target="_blank">CJEstrada</a> &middot; <a href="https://ph.linkedin.com/in/jolanzrodrigo"title="Developer"target="_blank">JRodrigo</a> &middot; <a href="https://ph.linkedin.com/in/wyethsy" title="Consultant"target="_blank">WSy</a>'
      );
      var autolinker = new Autolinker({
        truncate: {
          length: 30,
          location: 'smart'
        }
      });

      //Geocoder
      // var osmGeocoder = new L.Control.Geocoder({
      //         collapsed: false,
      //         position: 'bottomleft',
      //       }).addTo(map);

      //       document.getElementsByClassName('leaflet-control-geocoder-icon')[0].className += ' fa fa-map-location-dot';
      //       document.getElementsByClassName('leaflet-control-geocoder-icon')[0].title +=
      //         'Search for a place, such as Barangay, Muncipality, etc.';

      // Code A: Initialize osmGeocoder
      // Create the geocoder control








      // Custom control for coordinates input
      // var CoordinatesInputControl = L.Control.extend({
      //   options: {
      //     position: 'bottomleft'
      //   },

      //   onAdd: function (map) {
      //     var container = L.DomUtil.create('div', 'coordinates-input-control leaflet-bar');
      //     container.innerHTML = `
      //     <input type="text" id="coordinates" placeholder="Search for Longitude, Latitude" />
      //   `;
      //     L.DomEvent.disableClickPropagation(container);
      //     return container;
      //   }
      // });

      // // Add the custom control to the map
      // var coordinatesInputControl = new CoordinatesInputControl().addTo(map);

      // // Add a marker to the map
      // var marker = L.marker([0, 0]).addTo(map);
      // marker.setOpacity(0);

      // // Event listener for the coordinates input
      // document.getElementById('coordinates').addEventListener('keydown', function (event) {
      //   if (event.keyCode === 13) {
      //     var coordinates = event.target.value.split(',');
      //     var latitude = parseFloat(coordinates[0]);
      //     var longitude = parseFloat(coordinates[1]);

      //     if (isNaN(latitude) || isNaN(longitude)) {
      //       alert('Please enter valid coordinates.');
      //       return;
      //     }

      //     var latLng = L.latLng(latitude, longitude);
      //     marker.setLatLng(latLng);
      //     marker.setOpacity(1);
      //     map.setView(latLng, map.getZoom());
      //   }
      // });


      //Calculator--------------------------------------------------------------------------------------------------
      function calculate() {
        var ghi = parseFloat(document.getElementById("ghi").value);
        var slope = parseFloat(document.getElementById("slope").value);
        var tl_distance = parseFloat(document.getElementById("tl_distance").value);
        var purchase_price = parseFloat(document.getElementById("purchase_price").value);
        var total_area = parseFloat(document.getElementById("total_area").value);

        if (ghi > 0 && slope > 0 && tl_distance > 0 && purchase_price > 0 && total_area > 0) {
          var result = Math.round((ghi < 1750 ? 1 : ghi > 1950 ? 10 : (((9 * (ghi - 1750)) / 200) + 1)) * 0.1989 +
            (
              slope < 0.08 ? 10 : 5) * 0.1829 + (tl_distance < 5 ? 10 : tl_distance > 15 ? 1 : (((9 * (15 -
              tl_distance)) / 10) + 1)) * 0.2329 + (purchase_price < 150 ? 10 : purchase_price > 350 ? 1 : (((
              9 *
              (
                350 -
                purchase_price)) / 200) + 1)) * 0.0438 + (total_area < 100 ? 0.975 : total_area > 300 ? 10 : ((-
                0.000000000122212 * Math.pow(total_area, 5)) + (0.000000127783385 * Math.pow(total_area, 4)) -
              (
                0.000051519346125 * Math.pow(total_area, 3)) + (0.009822457821232 * Math.pow(total_area, 2)) -
              (
                0.818987139682201 * total_area) + 24.612688789833400)) * 0.3414, 1);
          document.getElementById("result").value = result;
        } else {
          alert("Please enter valid input values for all fields!");
        }
      }

      //_____________________________________________________________________________________________________________________________________________
      // Function to handle KML, KMZ, and GeoJSON files

      //  // Create the L.easyButton with KML, KMZ, and GeoJSON upload functionality
       L.easyButton({
        states: [{
          stateName: 'upload-file',
          icon: 'fa-file-import',
          title: 'Upload KML/KMZ/GeoJSON',
          onClick: function (control) {
            holder_fileInput.click();
          }
        }]
      }).addTo(map);




      // // Get the upload button element
      // var uploadButton = document.getElementById('uploadButton');

      // // Create a hidden file input element for KML, KMZ, and GeoJSON file selection
      // var fileInput = document.createElement('input');
      // fileInput.type = 'file';
      // fileInput.accept = '.kml,.kmz,.geojson';
      // fileInput.style.display = 'none';
      // document.body.appendChild(fileInput);

      // // Add event listener to the upload button
      // uploadButton.addEventListener('click', function () {
      //   fileInput.click();
      // });

      // // Add event listener to the file input element
      // fileInput.addEventListener('change', function () {
      //   if (fileInput.files.length > 0) {
      //     handleFile(fileInput.files[0]);
      //   }
      // });

      // // Function to handle the uploaded file
      // async function handleFile(file) {
      //   let geojson;
      //   if (file.name.endsWith('.kml') || file.name.endsWith('.kmz')) {
      //     let kmlText;
      //     if (file.name.endsWith('.kmz')) {
      //       const zip = new JSZip();
      //       const content = await zip.loadAsync(file);
      //       const kmlFile = content.files[Object.keys(content.files).find(name => name.endsWith('.kml'))];
      //       kmlText = await kmlFile.async('text');
      //     } else {
      //       kmlText = await file.text();
      //     }

      //     const parser = new DOMParser();
      //     const kml = parser.parseFromString(kmlText, 'text/xml');
      //     geojson = toGeoJSON.kml(kml);
      //   } else if (file.name.endsWith('.geojson')) {
      //     const fileText = await file.text();
      //     geojson = JSON.parse(fileText);
      //   } else {
      //     alert('Unsupported file format. Please upload KML, KMZ, or GeoJSON files.');
      //     return;
      //   }

      //   if (!geojson) {
      //     console.error('GeoJSON data is not defined');
      //     return;
      //   }



      //   var layer = L.geoJSON(geojson, {
      //     onEachFeature: function (feature, layer) {
      //       if (!layer._defaultShape || !layer.getLatLngs) {
      //         console.error('Layer is not a valid shape');
      //         return;
      //       }
      //       const area = L.GeometryUtil.readableArea((L.GeometryUtil.geodesicArea(layer._defaultShape ?
      //         layer
      //         ._defaultShape() : layer.getLatLngs())), true);
      //       const name = feature.properties.name || 'Unnamed feature';
      //       layer.bindPopup("<strong>" + name + "</strong><br/>" + "Area: ~" + area);
      //     },
      //     style: {
      //       color: 'yellow',
      //       clickable: true,
      //       fillOpacity: .1,
      //       fillColor: '#fff'
      //     },
      //     pointToLayer: function (data, latlng) {
      //       return L.circleMarker(latlng, {
      //         style: {
      //           color: 'yellow'
      //         }
      //       });
      //     }
      //   });
      //   // Overlay the uploaded layer on the map
      //   layer.addTo(map);
      //   map.fitBounds(layer.getBounds());
      // }

      // Create the L.easyButton with KML, KMZ, and GeoJSON upload functionality
      // L.easyButton({
      //   states: [{
      //     stateName: 'upload-file',
      //     icon: 'fa-file-import',
      //     title: 'Upload KML/KMZ/GeoJSON',
      //     onClick: function (control) {
      //       fileInput.click();
      //     }
      //   }]
      // }).addTo(map);




      // Create a hidden file input element for KML, KMZ, and GeoJSON file selection
      var fileInput = document.createElement('input');
      fileInput.type = 'file';
      fileInput.accept = '.kml,.kmz,.geojson';
      fileInput.style.display = 'none';
      document.body.appendChild(fileInput);

      // Add event listener to the file input element
      fileInput.addEventListener('change', function () {
        if (fileInput.files.length > 0) {
          handleFile(fileInput.files[0]);
        }
      });

      // Function to handle the uploaded file
      async function handleFile(file) {
        let geojson;
        if (file.name.endsWith('.kml') || file.name.endsWith('.kmz')) {
          let kmlText;
          if (file.name.endsWith('.kmz')) {
            const zip = new JSZip();
            const content = await zip.loadAsync(file);
            const kmlFile = content.files[Object.keys(content.files).find(name => name.endsWith('.kml'))];
            kmlText = await kmlFile.async('text');
          } else {
            kmlText = await file.text();
          }

          const parser = new DOMParser();
          const kml = parser.parseFromString(kmlText, 'text/xml');
          geojson = toGeoJSON.kml(kml);
        } else if (file.name.endsWith('.geojson')) {
          const fileText = await file.text();
          geojson = JSON.parse(fileText);
        } else {
          alert('Unsupported file format. Please upload KML, KMZ, or GeoJSON files.');
          return;
        }

        if (!geojson) {
          console.error('GeoJSON data is not defined');
          return;
        }

        var layer = L.geoJSON(geojson, {
          onEachFeature: function (feature, layer) {
            if (!layer._defaultShape || !layer.getLatLngs) {
              console.error('Layer is not a valid shape');
              return;
            }
            const area = L.GeometryUtil.readableArea((L.GeometryUtil.geodesicArea(layer._defaultShape ?
              layer
              ._defaultShape() : layer.getLatLngs())), true);
            const name = feature.properties.name || 'Unnamed feature';
            layer.bindPopup("<strong>" + name + "</strong><br/>" + "Area: ~" + area);
          },
          style: {
            color: 'yellow',
            clickable: true,
            fillOpacity: .1,
            fillColor: '#fff'
          },
          pointToLayer: function (data, latlng) {
            return L.circleMarker(latlng, {
              style: {
                color: 'yellow'
              }
            });
          }
        });

        // Overlay the uploaded layer on the map
        layer.addTo(map);
        map.fitBounds(layer.getBounds());
      }


      //_____________________________________________________________________________________________________________________________________________

      // Create a custom delete all polygons button
      var deleteAllButton = L.easyButton({
        states: [{
          stateName: 'delete-all',
          icon: 'fa-trash',
          title: 'Delete All',
          onClick: function (btn, map) {
            drawnItems.clearLayers();
          }
        }]
      }).addTo(map);

      //_____________________________________________________________________________________________________________________________________________

      $(document).ready(function () {
        // Add click event to the settings-card
        $('#settings-card').click(function () {
          $('#sidebar-three').toggleClass('open');
        });
      });




      //_____________________________________________________________________________________________________________________________________________
      // // Create the export EasyButton
      // var exportButton = L.easyButton({
      //   states: [{
      //     stateName: 'export',
      //     icon: 'fa-download',
      //     title: 'Export all polygons',
      //     onClick: function (btn, map) {
      //       // Extract GeoJson from featureGroup
      //       var data = drawnItems.toGeoJSON();

      //       // Stringify the GeoJson
      //       var convertedData = 'text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(data));

      //       // Create export
      //       var exportLink = document.createElement('a');
      //       exportLink.setAttribute('href', 'data:' + convertedData);
      //       exportLink.setAttribute('download', 'data.geojson');
      //       exportLink.click();
      //     }
      //   }]
      // }).addTo(map);



      // // Get the export button element
      // var exportButton = document.getElementById('exportButton');

      // // Add event listener to the export button
      // exportButton.addEventListener('click', function () {
      //   // Extract GeoJSON from featureGroup
      //   var data = drawnItems.toGeoJSON();

      //   // Stringify the GeoJSON
      //   var convertedData = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(data));

      //   // Create export link
      //   var exportLink = document.createElement('a');
      //   exportLink.setAttribute('href', convertedData);
      //   exportLink.setAttribute('download', 'data.geojson');
      //   exportLink.style.display = 'none';
      //   document.body.appendChild(exportLink);
      //   exportLink.click();
      //   document.body.removeChild(exportLink);
      // });

      // Create the export EasyButton
      // Create the export EasyButton
      // Create the export EasyButton
      var exportButton = L.easyButton({
        states: [{
          stateName: 'export',
          icon: 'fa-download',
          title: 'Export all polygons',
          onClick: function (btn, map) {
            // Extract GeoJson from featureGroup
            var data = drawnItems.toGeoJSON();

            // Stringify the GeoJson
            var convertedData = JSON.stringify(data, null, 2);

            // Create export link
            var exportLink = document.createElement('a');
            exportLink.setAttribute('href', 'data:text/json;charset=utf-8,' + encodeURIComponent(
              convertedData));
            exportLink.setAttribute('download', 'data.geojson');
            exportLink.style.display = 'none';
            document.body.appendChild(exportLink);
            exportLink.click();
            document.body.removeChild(exportLink);

            // Fit the map to the bounds of the drawn items if the bounds are valid
            var bounds = drawnItems.getBounds();
            if (bounds.isValid()) {
              map.fitBounds(bounds);
            }
          }
        }]
      }).addTo(map);



      //_____________________________________________________________________________________________________________________________________________



      // Create the search bar and its functionality
      var searchContainer = document.createElement('div');
      searchContainer.id = 'searchContainer';
      searchContainer.className = 'search-container';

      var inputGroup = document.createElement('div');
      inputGroup.className = 'input-group';

      var searchInput = document.createElement('input');
      searchInput.id = 'searchInput';
      searchInput.className = 'form-control search-input';
      searchInput.type = 'text';
      searchInput.placeholder = 'Search...';

      var searchButton = document.createElement('button');
      searchButton.id = 'searchButton';
      searchButton.className = 'btn btn-primary btn-sm search-button';
      searchButton.type = 'button';
      searchButton.innerHTML = 'Search';

      inputGroup.appendChild(searchInput);
      inputGroup.appendChild(searchButton);
      searchContainer.appendChild(inputGroup);
      document.body.appendChild(searchContainer);

      // Event listener for the search button
      searchButton.addEventListener('click', function () {
        var searchTerm = searchInput.value;
        // Perform the search functionality based on the search term
        // ...
        console.log('Search term:', searchTerm);
      });

      //_____________________________________________________________________________________________________________________________________________

      //---------------------------------------TILE LAYERS------------------------------------------------------------------------//
      //OpenTopo
      map.createPane('pane_OpenTopo');
      map.getPane('pane_OpenTopo').style.zIndex = 104;
      var layer_OpenTopo = L.tileLayer('https://tile.opentopomap.org/{z}/{x}/{y}.png', {
        pane: 'pane_OpenTopo',
        opacity: 1,
        attribution: '',
        minZoom: 1,
        maxZoom: 28,
        minNativeZoom: 0,
        maxNativeZoom: 25
      });
      layer_OpenTopo;

      //EsriTopo
      map.createPane('pane_EsriTopo');
      map.getPane('pane_EsriTopo').style.zIndex = 103;
      var layer_EsriTopo = L.tileLayer(
        'https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}', {
          pane: 'pane_EsriTopo',
          opacity: 1,
          attribution: '',
          minZoom: 1,
          maxZoom: 28,
          minNativeZoom: 0,
          maxNativeZoom: 18
        });
      layer_EsriTopo;


      map.createPane('pane_ServiceContractMap_1');
      map.getPane('pane_ServiceContractMap_1').style.zIndex = 110;
      map.getPane('pane_ServiceContractMap_1').style['mix-blend-mode'] = 'normal';
      var layer_ServiceContractMap_1 = new L.geoJson(json_ServiceContractMap_1, {
        attribution: '',
        interactive: true,
        dataVar: 'json_ServiceContractMap_1',
        layerName: 'layer_ServiceContractMap_1',
        pane: 'pane_ServiceContractMap_1',
        onEachFeature: pop_ServiceContractMap_1,
        style: style_ServiceContractMap_1_0,
      });
      bounds_group.addLayer(layer_ServiceContractMap_1);
      map.addLayer(layer_ServiceContractMap_1);


      //Ancestral_Domains
      map.createPane('pane_AncestralDomain_3');
      map.getPane('pane_AncestralDomain_3').style.zIndex = 109;
      map.getPane('pane_AncestralDomain_3').style['mix-blend-mode'] = 'normal';
      var layer_AncestralDomain_3 = new L.geoJson(json_AncestralDomain_3, {
        attribution: '',
        interactive: true,
        dataVar: 'json_AncestralDomain_3',
        layerName: 'layer_AncestralDomain_3',
        pane: 'pane_AncestralDomain_3',
        onEachFeature: pop_AncestralDomain_3,
        style: style_AncestralDomain_3_0,
      });
      bounds_group.addLayer(layer_AncestralDomain_3);

      //Protected_Areas
      map.createPane('pane_ProtectedAreas_4');
      map.getPane('pane_ProtectedAreas_4').style.zIndex = 108;
      map.getPane('pane_ProtectedAreas_4').style['mix-blend-mode'] = 'normal';
      var layer_ProtectedAreas_4 = new L.geoJson(json_ProtectedAreas_4, {
        attribution: '',
        interactive: true,
        dataVar: 'json_ProtectedAreas_4',
        layerName: 'layer_ProtectedAreas_4',
        pane: 'pane_ProtectedAreas_4',
        onEachFeature: pop_ProtectedAreas_4,
        style: style_ProtectedAreas_4_0,
      });
      bounds_group.addLayer(layer_ProtectedAreas_4);

      //Key_Biodiversity
      map.createPane('pane_KeyBiodiversityAreas_5');
      map.getPane('pane_KeyBiodiversityAreas_5').style.zIndex = 107;
      var layer_KeyBiodiversityAreas_5 = L.WMS.layer("https://geoserver.geoportal.gov.ph/geoserver/geoportal/wms",
        "keybiodiversityareas_202005", {
          pane: 'pane_KeyBiodiversityAreas_5',
          format: 'image/png',
          uppercase: true,
          transparent: true,
          continuousWorld: true,
          tiled: true,
          info_format: 'text/html',
          opacity: 0.6,
          identify: true,
          attribution: '',
        });
      layer_KeyBiodiversityAreas_5;

      //River and Water Bodies
      map.createPane('pane_RVRWBS');
      map.getPane('pane_RVRWBS').style.zIndex = 111;
      var layer_RVRWBS = L.tileLayer('https://github.com/czrxstrd4/RVRWBS/raw/main/RVRWBS/{z}/{x}/{y}.png', {
        pane: 'pane_RVRWBS',
        opacity: 0.6,
        attribution: '',
        minZoom: 1,
        maxZoom: 28,
        minNativeZoom: 4,
        maxNativeZoom: 14
      });
      layer_RVRWBS;

      //Flood_Hazard
      map.createPane('pane_FloodHazard_25yrs_6');
      map.getPane('pane_FloodHazard_25yrs_6').style.zIndex = 113;
      var layer_FloodHazard_25yrs_6 = L.tileLayer(
        'https://github.com/czrxstrd4/FLDHM/raw/main/Tiles/{z}/{x}/{y}.png', {
          pane: 'pane_FloodHazard_25yrs_6',
          opacity: 0.6,
          attribution: '',
          minZoom: 1,
          maxZoom: 28,
          minNativeZoom: 4,
          maxNativeZoom: 14
        });
      layer_FloodHazard_25yrs_6;

      //Liquefaction
      map.createPane('pane_LQFCN');
      map.getPane('pane_LQFCN').style.zIndex = 112;
      var layer_LQFCN = L.tileLayer('https://github.com/czrxstrd4/LQFCN/raw/main/LQFCN/{z}/{x}/{y}.png', {
        pane: 'pane_LQFCN',
        opacity: 0.6,
        attribution: '',
        minZoom: 1,
        maxZoom: 28,
        minNativeZoom: 4,
        maxNativeZoom: 14
      });
      layer_LQFCN;
      //Active_Fault
      map.createPane('pane_ActiveFault_13');
      map.getPane('pane_ActiveFault_13').style.zIndex = 121;
      map.getPane('pane_ActiveFault_13').style['mix-blend-mode'] = 'normal';
      var layer_ActiveFault_13 = new L.geoJson(json_ActiveFault_13, {
        attribution: '',
        interactive: true,
        dataVar: 'json_ActiveFault_13',
        layerName: 'layer_ActiveFault_13',
        pane: 'pane_ActiveFault_13',
        onEachFeature: pop_ActiveFault_13,
        style: style_ActiveFault_13_0,
      });
      bounds_group.addLayer(layer_ActiveFault_13);



      //Active_Volcano
      map.createPane('pane_Volcanoes_7');
      map.getPane('pane_Volcanoes_7').style.zIndex = 121;
      map.getPane('pane_Volcanoes_7').style['mix-blend-mode'] = 'normal';
      var layer_Volcanoes_7 = new L.geoJson(json_Volcanoes_7, {
        attribution: '',
        interactive: true,
        dataVar: 'json_Volcanoes_7',
        layerName: 'layer_Volcanoes_7',
        pane: 'pane_Volcanoes_7',
        onEachFeature: pop_Volcanoes_7,
        pointToLayer: function (feature, latlng) {
          var context = {
            feature: feature,
            variables: {}
          };
          return L.shapeMarker(latlng, style_Volcanoes_7_0(feature));
        },
      });
      bounds_group.addLayer(layer_Volcanoes_7);

      //Lahar
      map.createPane('pane_Lahar_6');
      map.getPane('pane_Lahar_6').style.zIndex = 120;
      map.getPane('pane_Lahar_6').style['mix-blend-mode'] = 'normal';
      var layer_Lahar_6 = new L.geoJson(json_Lahar_6, {
        attribution: '',
        interactive: true,
        dataVar: 'json_Lahar_6',
        layerName: 'layer_Lahar_6',
        pane: 'pane_Lahar_6',
        onEachFeature: pop_Lahar_6,
        style: style_Lahar_6_0,
      });
      bounds_group.addLayer(layer_Lahar_6);

      //Lava
      map.createPane('pane_Lava_5');
      map.getPane('pane_Lava_5').style.zIndex = 119;
      map.getPane('pane_Lava_5').style['mix-blend-mode'] = 'normal';
      var layer_Lava_5 = new L.geoJson(json_Lava_5, {
        attribution: '',
        interactive: true,
        dataVar: 'json_Lava_5',
        layerName: 'layer_Lava_5',
        pane: 'pane_Lava_5',
        onEachFeature: pop_Lava_5,
        style: style_Lava_5_0,
      });
      bounds_group.addLayer(layer_Lava_5);

      //Pyroclastic_Flow
      map.createPane('pane_PyroclasticFlow_4');
      map.getPane('pane_PyroclasticFlow_4').style.zIndex = 118;
      map.getPane('pane_PyroclasticFlow_4').style['mix-blend-mode'] = 'normal';
      var layer_PyroclasticFlow_4 = new L.geoJson(json_PyroclasticFlow_4, {
        attribution: '',
        interactive: true,
        dataVar: 'json_PyroclasticFlow_4',
        layerName: 'layer_PyroclasticFlow_4',
        pane: 'pane_PyroclasticFlow_4',
        onEachFeature: pop_PyroclasticFlow_4,
        style: style_PyroclasticFlow_4_0,
      });
      bounds_group.addLayer(layer_PyroclasticFlow_4);

      //Taal_Ballistic
      map.createPane('pane_TaalBallisticProjectiles_3');
      map.getPane('pane_TaalBallisticProjectiles_3').style.zIndex = 117;
      map.getPane('pane_TaalBallisticProjectiles_3').style['mix-blend-mode'] = 'normal';
      var layer_TaalBallisticProjectiles_3 = new L.geoJson(json_TaalBallisticProjectiles_3, {
        attribution: '',
        interactive: true,
        dataVar: 'json_TaalBallisticProjectiles_3',
        layerName: 'layer_TaalBallisticProjectiles_3',
        pane: 'pane_TaalBallisticProjectiles_3',
        onEachFeature: pop_TaalBallisticProjectiles_3,
        style: style_TaalBallisticProjectiles_3_0,
      });
      bounds_group.addLayer(layer_TaalBallisticProjectiles_3);

      //Taal_Fissuring
      map.createPane('pane_TaalFissuring_2');
      map.getPane('pane_TaalFissuring_2').style.zIndex = 116;
      map.getPane('pane_TaalFissuring_2').style['mix-blend-mode'] = 'normal';
      var layer_TaalFissuring_2 = new L.geoJson(json_TaalFissuring_2, {
        attribution: '',
        interactive: true,
        dataVar: 'json_TaalFissuring_2',
        layerName: 'layer_TaalFissuring_2',
        pane: 'pane_TaalFissuring_2',
        onEachFeature: pop_TaalFissuring_2,
        style: style_TaalFissuring_2_0,
      });
      bounds_group.addLayer(layer_TaalFissuring_2);

      //Taal_Buffer
      map.createPane('pane_TaalBufferRings_1');
      map.getPane('pane_TaalBufferRings_1').style.zIndex = 115;
      map.getPane('pane_TaalBufferRings_1').style['mix-blend-mode'] = 'normal';
      var layer_TaalBufferRings_1 = new L.geoJson(json_TaalBufferRings_1, {
        attribution: '',
        interactive: true,
        dataVar: 'json_TaalBufferRings_1',
        layerName: 'layer_TaalBufferRings_1',
        pane: 'pane_TaalBufferRings_1',
        onEachFeature: pop_TaalBufferRings_1,
        style: style_TaalBufferRings_1_0,
      });
      bounds_group.addLayer(layer_TaalBufferRings_1);

      //Seaports
      map.createPane('pane_Seaports_14');
      map.getPane('pane_Seaports_14').style.zIndex = 122;
      map.getPane('pane_Seaports_14').style['mix-blend-mode'] = 'normal';
      var layer_Seaports_14 = new L.geoJson(json_Seaports_14, {
        attribution: '',
        interactive: true,
        dataVar: 'json_Seaports_14',
        layerName: 'layer_Seaports_14',
        pane: 'pane_Seaports_14',
        onEachFeature: pop_Seaports_14,
        pointToLayer: function (feature, latlng) {
          var context = {
            feature: feature,
            variables: {}
          };
          return L.circleMarker(latlng, style_Seaports_14_0(feature));
        },
      });
      bounds_group.addLayer(layer_Seaports_14);

      //Roads
      map.createPane('pane_RDS');
      map.getPane('pane_RDS').style.zIndex = 106;
      var layer_RDS = L.tileLayer('https://github.com/czrxstrd4/RDS/raw/main/RDS/{z}/{x}/{y}.png', {
        pane: 'pane_RDS',
        opacity: 1,
        attribution: '',
        minZoom: 1,
        maxZoom: 28,
        minNativeZoom: 4,
        maxNativeZoom: 14
      });
      layer_RDS;

      //Barangay
      map.createPane('pane_BarangaysMin_1');
      map.getPane('pane_BarangaysMin_1').style.zIndex = 106;
      map.getPane('pane_BarangaysMin_1').style['mix-blend-mode'] = 'normal';
      var layer_BarangaysMin_1 = new L.geoJson(json_BarangaysMin_1, {
        attribution: '',
        interactive: true,
        dataVar: 'json_BarangaysMin_1',
        layerName: 'layer_BarangaysMin_1',
        pane: 'pane_BarangaysMin_1',
        onEachFeature: pop_BarangaysMin_1,
        style: style_BarangaysMin_1_0,
      });
      bounds_group.addLayer(layer_BarangaysMin_1);

      map.createPane('pane_ExistingTL_1');
      map.getPane('pane_ExistingTL_1').style.zIndex = 123;
      map.getPane('pane_ExistingTL_1').style['mix-blend-mode'] = 'normal';
      var layer_ExistingTL_1 = new L.geoJson(json_ExistingTL_1, {
        attribution: '',
        interactive: true,
        dataVar: 'json_ExistingTL_1',
        layerName: 'layer_ExistingTL_1',
        pane: 'pane_ExistingTL_1',
        onEachFeature: pop_ExistingTL_1,
        style: style_ExistingTL_1_0,
      });
      layer_ExistingTL_1;

      map.createPane('pane_TDPTL_2');
      map.getPane('pane_TDPTL_2').style.zIndex = 124;
      map.getPane('pane_TDPTL_2').style['mix-blend-mode'] = 'normal';
      var layer_TDPTL_2 = new L.geoJson(json_TDPTL_2, {
        attribution: '',
        interactive: true,
        dataVar: 'json_TDPTL_2',
        layerName: 'layer_TDPTL_2',
        pane: 'pane_TDPTL_2',
        onEachFeature: pop_TDPTL_2,
        style: style_TDPTL_2_0,
      });
      layer_TDPTL_2;

      map.createPane('pane_PlantCustomerownedSubstations_3');
      map.getPane('pane_PlantCustomerownedSubstations_3').style.zIndex = 125;
      map.getPane('pane_PlantCustomerownedSubstations_3').style['mix-blend-mode'] = 'normal';
      var layer_PlantCustomerownedSubstations_3 = new L.geoJson(json_PlantCustomerownedSubstations_3, {
        attribution: '',
        interactive: true,
        dataVar: 'json_PlantCustomerownedSubstations_3',
        layerName: 'layer_PlantCustomerownedSubstations_3',
        pane: 'pane_PlantCustomerownedSubstations_3',
        onEachFeature: pop_PlantCustomerownedSubstations_3,
        pointToLayer: function (feature, latlng) {
          var context = {
            feature: feature,
            variables: {}
          };
          return L.circleMarker(latlng, style_PlantCustomerownedSubstations_3_0(feature));
        },
      });
      layer_PlantCustomerownedSubstations_3;

      map.createPane('pane_69kVDULoadendSubstations_4');
      map.getPane('pane_69kVDULoadendSubstations_4').style.zIndex = 126;
      map.getPane('pane_69kVDULoadendSubstations_4').style['mix-blend-mode'] = 'normal';
      var layer_69kVDULoadendSubstations_4 = new L.geoJson(json_69kVDULoadendSubstations_4, {
        attribution: '',
        interactive: true,
        dataVar: 'json_69kVDULoadendSubstations_4',
        layerName: 'layer_69kVDULoadendSubstations_4',
        pane: 'pane_69kVDULoadendSubstations_4',
        onEachFeature: pop_69kVDULoadendSubstations_4,
        pointToLayer: function (feature, latlng) {
          var context = {
            feature: feature,
            variables: {}
          };
          return L.circleMarker(latlng, style_69kVDULoadendSubstations_4_0(feature));
        },
      });
      layer_69kVDULoadendSubstations_4;

      map.createPane('pane_500230138115kVExistingSubstations_5');
      map.getPane('pane_500230138115kVExistingSubstations_5').style.zIndex = 127;
      map.getPane('pane_500230138115kVExistingSubstations_5').style['mix-blend-mode'] = 'normal';
      var layer_500230138115kVExistingSubstations_5 = new L.geoJson(json_500230138115kVExistingSubstations_5, {
        attribution: '',
        interactive: true,
        dataVar: 'json_500230138115kVExistingSubstations_5',
        layerName: 'layer_500230138115kVExistingSubstations_5',
        pane: 'pane_500230138115kVExistingSubstations_5',
        onEachFeature: pop_500230138115kVExistingSubstations_5,
        pointToLayer: function (feature, latlng) {
          var context = {
            feature: feature,
            variables: {}
          };
          return L.circleMarker(latlng, style_500230138115kVExistingSubstations_5_0(feature));
        },
      });
      layer_500230138115kVExistingSubstations_5;

      map.createPane('pane_500230kVTDPSubstations_6');
      map.getPane('pane_500230kVTDPSubstations_6').style.zIndex = 128;
      map.getPane('pane_500230kVTDPSubstations_6').style['mix-blend-mode'] = 'normal';
      var layer_500230kVTDPSubstations_6 = new L.geoJson(json_500230kVTDPSubstations_6, {
        attribution: '',
        interactive: true,
        dataVar: 'json_500230kVTDPSubstations_6',
        layerName: 'layer_500230kVTDPSubstations_6',
        pane: 'pane_500230kVTDPSubstations_6',
        onEachFeature: pop_500230kVTDPSubstations_6,
        pointToLayer: function (feature, latlng) {
          var context = {
            feature: feature,
            variables: {}
          };
          return L.circleMarker(latlng, style_500230kVTDPSubstations_6_0(feature));
        },
      });
      layer_500230kVTDPSubstations_6;


      // var baseLayers = [{
      //     name: "Satellite",
      //     layer: layer_GoogleMapsSatellite_1
      //   },
      //   {
      //     name: "Satellite-Hybrid",
      //     layer: layer_GoogleSatelliteHybrid_1
      //   },
      //   {
      //     name: "Basic",
      //     layer: layer_GoogleMapsBasic_0
      //   },
      //   {
      //     name: "Live Satellite (April 2023)",
      //     layer: layer_planetNICFI
      //   }
      // ];
      // //Over_Layers
      // var overLayers = [{
      //     group: "Solar Suitability",
      //     collapsed: true,
      //     layers: [{
      //         name: 'GHI x Slope<br /><img src="legend/GHIxSlope.png" />',
      //         layer: layer_GHISLP
      //       },
      //       {
      //         name: 'Irradiance<br /><img src="legend/Irradiance.png" />',
      //         layer: layer_IRDGHI
      //       },
      //       {
      //         name: 'Slope Caps - Solar<br /><img src="legend/SlopeCaps-Solar.png" />',
      //         layer: layer_SLPSLR
      //       }
      //     ]
      //   },
      //   {
      //     group: "Wind Suitability",
      //     collapsed: true,
      //     layers: [{
      //         name: 'Wind Speed x Slope<br /><img src="legend/WSxSlope.png" />',
      //         layer: layer_WSSLP
      //       },
      //       {
      //         name: 'Wind Speed<br /><img src="legend/WindSpeed.png" />',
      //         layer: layer_WS,

      //       },
      //       {
      //         name: 'Slope Caps - Wind<br /><img src="legend/SlopeCaps-Wind.png" />',
      //         layer: layer_SLPWD,

      //       }
      //     ]
      //   },

      //   {
      //     group: "Area Restrictions",
      //     collapsed: true,
      //     layers: [{
      //         name: 'Service Contract<br /><table><tr><td style="text-align: center;"><img src="legend/Merged_2_Geothermal0.png" /></td><td>Geothermal</td></tr><tr><td style="text-align: center;"><img src="legend/Merged_2_OffshoreWind1.png" /></td><td>Offshore Wind</td></tr><tr><td style="text-align: center;"><img src="legend/Merged_2_OnshoreWind2.png" /></td><td>Onshore Wind</td></tr><tr><td style="text-align: center;"><img src="legend/Merged_2_Solar3.png" /></td><td>Solar</td></tr></table>',
      //         layer: layer_ServiceContractMap_1,


      //       },
      //       {
      //         name: "Ancestral Domains",
      //         layer: layer_AncestralDomain_3,
      //         icon: '<i class="fa fa-universal-access" aria-hidden="true"></i>'
      //       },
      //       {
      //         name: "Protected Areas",
      //         layer: layer_ProtectedAreas_4,
      //         icon: '<i class="fa fa-leaf" aria-hidden="true"></i>'
      //       },
      //       {
      //         name: 'Key Biodiversity Areas<br /><img src="legend/KBA.png" />',
      //         layer: layer_KeyBiodiversityAreas_5,

      //       }
      //     ]
      //   },

      //   {
      //     group: "Hazards",
      //     collapsed: true,
      //     layers: [{
      //         name: "River & Water Bodies",
      //         layer: layer_RVRWBS,
      //         icon: '<i class="fa fa-tint" aria-hidden="true"></i>'

      //       },
      //       {
      //         name: 'Flood Hazard<br /><img src="legend/Flood.png" />',
      //         layer: layer_FloodHazard_25yrs_6

      //       },
      //       {
      //         name: 'Active Faults<br /><img src="legend/Fault.png" />',
      //         layer: layer_ActiveFault_13,

      //       },
      //       {
      //         name: 'Liquefaction<br /><img src="legend/Liquefaction.png" />',
      //         layer: layer_LQFCN,

      //       }

      //     ]
      //   },

      //   {
      //     group: "Hazards - Volcano",
      //     collapsed: true,
      //     layers: [{
      //         name: 'Active Volcanoes<br /><img src="legend/Volcanoes.png" />',
      //         layer: layer_Volcanoes_7
      //       },
      //       {
      //         name: 'Lahar<br /><img src="legend/Lahar.png" />',
      //         layer: layer_Lahar_6

      //       },
      //       {
      //         name: "Lava",
      //         layer: layer_Lava_5

      //       },
      //       {
      //         name: "Pyroclastic Flow",
      //         layer: layer_PyroclasticFlow_4

      //       },
      //       {
      //         name: "Taal Ballistic Projectiles",
      //         layer: layer_TaalBallisticProjectiles_3

      //       },
      //       {
      //         name: "Taal Fissuring",
      //         layer: layer_TaalFissuring_2

      //       },
      //       {
      //         name: 'Taal Buffer Rings<br /><img src="legend/Taal_Buffer.png" />',
      //         layer: layer_TaalBufferRings_1

      //       }

      //     ]
      //   },

      //   {
      //     group: "Added layer",
      //     collapsed: true,
      //     layers: [{
      //         name: "Drawn Layer",
      //         layer: drawnItems,
      //         icon: '<i class="fa fa-pencil-square-o" aria-hidden="true"></i>'

      //       },
      //       {
      //         name: "Uploaded Layer",
      //         layer: fileUploaders,
      //         icon: '<i class="fa fa-upload" aria-hidden="true"></i>'

      //       }


      //     ]
      //   },

      //   {
      //     group: "Others",
      //     collapsed: true,
      //     layers: [{
      //         name: "Seaports",
      //         layer: layer_Seaports_14,
      //         icon: '<img src="legend/Seaports_14.png" />'
      //       },
      //       {
      //         name: "Roads",
      //         layer: layer_RDS,
      //         icon: '<img src="legend/Roads.png" />'
      //       },
      //       {
      //         name: "Barangays",
      //         layer: layer_BarangaysMin_1,
      //         icon: '<img src="legend/BarangaysMin_1.png" />'
      //       }


      //     ]
      //   },

      //   {
      //     group: "Transmission SS & TL",
      //     collapsed: true,
      //     layers: [{
      //         name: "Existing SS (Above 69kV)",
      //         layer: layer_500230138115kVExistingSubstations_5,
      //         icon: '<img src="legend/500230138115kVExistingSubstations_5.png" />'
      //       },
      //       {
      //         name: "TDP SS",
      //         layer: layer_500230kVTDPSubstations_6,
      //         icon: '<img src="legend/500230kVTDPSubstations_6.png" />'
      //       },
      //       {
      //         name: "Existing SS (69kV)",
      //         layer: layer_69kVDULoadendSubstations_4,
      //         icon: '<img src="legend/69kVDULoadendSubstations_4.png" />'
      //       },
      //       {
      //         name: "Plant-Owned SS",
      //         layer: layer_PlantCustomerownedSubstations_3,
      //         icon: '<img src="legend/PlantCustomerownedSubstations_3.png" />'
      //       },
      //       {
      //         name: "Existing TL",
      //         layer: layer_ExistingTL_1,
      //         icon: '<img src="legend/ExistingTL_1.png" />'
      //       },
      //       {
      //         name: "TDP TL",
      //         layer: layer_TDPTL_2,
      //         icon: '<img src="legend/TDPTL_2.png" />'
      //       }


      //     ]
      //   },

      // ];

      // var panelLayers = new L.Control.PanelLayers(baseLayers, overLayers, {
      //   compact: false,
      //   collapsed: false,
      //   selectorGroup: true,
      //   collapsibleGroups: true,
      //   className: 'custom-panel'
      // });

      // map.addControl(panelLayers);
      // Get the container element for panel layers


      // Measure Button
      var measureControl = new L.Control.Measure({
        position: 'topleft',
        primaryLengthUnit: 'meters',
        secondaryLengthUnit: 'kilometers',
        primaryAreaUnit: 'sqmeters',
        secondaryAreaUnit: 'hectares'
      });
      measureControl.addTo(map);
      document.getElementsByClassName('leaflet-control-measure-toggle')[0]
        .innerHTML = '';
      document.getElementsByClassName('leaflet-control-measure-toggle')[0]
        .className += ' fas fa-ruler';

      // var measureControl = new L.Control.Measure({
      //   primaryLengthUnit: 'meters',
      //   secondaryLengthUnit: 'kilometers',
      //   primaryAreaUnit: 'sqmeters',
      //   secondaryAreaUnit: 'hectares'
      // });
      // measureControl.addTo(map);

      // var measureContainer = document.createElement('div');
      // measureContainer.className = 'leaflet-top leaflet-left';

      // var measureControlContainer = document.createElement('div');
      // measureControlContainer.id = 'measure-control';
      // measureControlContainer.appendChild(measureControl.getContainer());

      // measureContainer.appendChild(measureControlContainer);

      // var containerElement = document.getElementById('map');
      // containerElement.appendChild(measureContainer);


      //----------------------------------------------------------

      //--------------------------------------------------------------------Draw Polygons------------------------------------------------------------------------//

      var drawnItems = new L.FeatureGroup();
      map.addLayer(drawnItems);
      L.drawLocal.draw.toolbar.buttons.polygon = 'Draw a polygon';

      var drawControl = new L.Control.Draw({
        edit: {
          featureGroup: drawnItems,
          poly: {
            allowIntersection: false
          }
        },
        draw: {
          polygon: {
            allowIntersection: false,
            showArea: true
          }
        }
      });
      map.addControl(drawControl);

      var _round = function (num, len) {
        return Math.round(num * (Math.pow(10, len))) / (Math.pow(10, len));
      };

      var strLatLng = function (latlng) {
        return "(" + _round(latlng.lat, 6) + ", " + _round(latlng.lng, 6) + ")";
      };

      var getPopupContent = function (layer) {
        if (layer instanceof L.Marker || layer instanceof L.CircleMarker) {
          return strLatLng(layer.getLatLng());
        } else if (layer instanceof L.Circle) {
          var center = layer.getLatLng(),
            radius = layer.getRadius();
          return "Center: " + strLatLng(center) + "<br />" +
            "Radius: ~" + _round(radius, 2) + " m";
        } else if (layer instanceof L.Polygon) {
          var latlngs = layer._defaultShape ? layer._defaultShape() : layer.getLatLngs(),
            area = L.GeometryUtil.geodesicArea(latlngs);
          return "Area: ~" + L.GeometryUtil.readableArea(area, true);
        } else if (layer instanceof L.Polyline) {
          var latlngs = layer._defaultShape ? layer._defaultShape() : layer.getLatLngs(),
            distance = 0;
          if (latlngs.length < 2) {
            return "Distance: N/A";
          } else {
            for (var i = 0; i < latlngs.length - 1; i++) {
              distance += latlngs[i].distanceTo(latlngs[i + 1]);
            }
            return "Distance: ~" + _round((distance / 1000), 2) + " km";
          }
        }
        return null;
      };

      map.on(L.Draw.Event.CREATED, function (event) {
        var layer = event.layer;
        var content = getPopupContent(layer);
        if (content !== null) {
          layer.bindPopup(content);
        }
        drawnItems.addLayer(layer);
      });

      map.on(L.Draw.Event.EDITED, function (event) {
        var layers = event.layers,
          content = null;
        layers.eachLayer(function (layer) {
          content = getPopupContent(layer);
          if (content !== null) {
            layer.setPopupContent(content);
          }
        });
      });

      document.getElementById('drawContainer').addEventListener('click', function () {
        if (drawControl._activeMode === 'draw') {
          drawControl._map.fire('draw:drawstop');
          drawControl._activeMode = null;
        } else {
          drawControl._map.fire('draw:drawstart');
          drawControl._activeMode = 'draw';
        }
      });

      document.getElementById('deleteAllContainer').addEventListener('click', function () {
        drawnItems.clearLayers();
      });

      // Add CSS class to the container elements
      document.getElementById('drawContainer').classList.add('drawLayer');
      document.getElementById('deleteAllContainer').classList.add('drawLayer');


      //--------------------------------------------------------------------End Draw Polygons------------------------------------------------------------------------//
      //Export Polygons---------------------------------------------------------------------------------------------

      // // Create the export EasyButton
      // var exportButton = L.easyButton({
      //   states: [{
      //     stateName: 'export',
      //     icon: 'fa-download',
      //     title: 'Export all polygons',
      //     onClick: function (btn, map) {
      //       // Extract GeoJson from featureGroup
      //       var data = drawnItems.toGeoJSON();

      //       // Stringify the GeoJson
      //       var convertedData = 'text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(data));

      //       // Create export
      //       var exportLink = document.createElement('a');
      //       exportLink.setAttribute('href', 'data:' + convertedData);
      //       exportLink.setAttribute('download', 'data.geojson');
      //       exportLink.click();
      //     }
      //   }]
      // }).addTo(map);

      // // Add tooltip when hovering over the button
      // exportButton.button.title = 'Export all polygons';



      //------------------------------------------------------------------------------------------------------------




      //-------------------------------------------------------Universal Search-----------------------------------------------------------------------------//




      //-------------------------------------------------------Universal Search-----------------------------------------------------------------------------//
      // Get the upload shapefile button element
      // var uploadShapefileButton = document.getElementById('fileInput');

      // // Add event listener to the upload shapefile button
      // uploadShapefileButton.addEventListener('change', function () {
      //   if (uploadShapefileButton.files.length > 0) {
      //     handleShapefile(uploadShapefileButton.files);
      //   }
      // });

      // // Function to handle the uploaded shapefile
      // async function handleShapefile(files) {
      //   var shapefile = new L.Shapefile(files[0]);

      //   shapefile.addTo(map);
      // }

      //--------------------------------------------------------------------GeoBlaze------------------------------------------------------------------------//

      // Display the GHI Map with identify function

      //Display filename for shapefile input
      // function displayFileName() {
      //   var fileInput = document.getElementById('fileInput');
      //   var fileNameSpan = document.getElementById('fileName');
      //   fileNameSpan.textContent = fileInput.files.length > 0 ? fileInput.files[0].name : "";
      // }

      function displayFileName() {
        var fileInput = document.getElementById('fileInput');
        var fileNameSpan = document.getElementById('fileName');
        var fileName = fileInput.files.length > 0 ? fileInput.files[0].name : "";

        fileNameSpan.textContent = fileName;

        var reader = new FileReader();

        reader.onload = function (e) {
          var geojson = JSON.parse(e.target.result);

          var layer = L.geoJSON(geojson, {
            onEachFeature: function (feature, layer) {
              if (!layer._defaultShape || !layer.getLatLngs) {
                console.error('Layer is not a valid shape');
                return;
              }
              const area = L.GeometryUtil.readableArea((L.GeometryUtil.geodesicArea(layer._defaultShape ?
                layer
                ._defaultShape() : layer.getLatLngs())), true);
              const name = feature.properties.name || 'Unnamed feature';
              layer.bindPopup("<strong>" + name + "</strong><br/>" + "Area: ~" + area);
            },
            style: {
              color: 'yellow',
              clickable: true,
              fillOpacity: .1,
              fillColor: '#fff'
            },
            pointToLayer: function (data, latlng) {
              return L.circleMarker(latlng, {
                style: {
                  color: 'yellow'
                }
              });
            }
          });

          // Overlay the uploaded layer on the map
          layer.addTo(map);
          map.fitBounds(layer.getBounds());
        };

        reader.readAsText(fileInput.files[0]);
      }




      //Create map values for GHI and WS
      map.createPane('GHIValues');
      map.getPane('GHIValues').style.zIndex = 102;

      var url_to_geotiff_GHI_files = "https://czrxstrd4.github.io/avemn/GHI.tif";

      var GHIValuesLayer; // Declare GHIValuesLayer variable

      fetch(url_to_geotiff_GHI_files)
        .then(response => response.arrayBuffer())
        .then(arrayBuffer => {
          parseGeoraster(arrayBuffer).then(georaster => {

            const min = georaster.mins[0];
            const max = georaster.maxs[0];
            const range = georaster.ranges[0];

            console.log("max:", max);
            console.log("min:", min);
            console.log("range:", range);

            var scale = chroma.scale("Viridis");

            GHIValuesLayer = new GeoRasterLayer({
              georaster: georaster,
              opacity: 0.4,
              pane: 'GHIValues',
              pixelValuesToColorFn: function (pixelValues) {
                var pixelValue = pixelValues[0];

                if (pixelValue === 0) return null;

                var scaledPixelValue = (pixelValue - min) / range;

                var color = scale(scaledPixelValue).hex();

                return color;
              }
            });

            // Toggle popups based on checkbox state
            var toggleCheckbox = document.getElementById('toggleCheckbox');
            toggleCheckbox.addEventListener('change', function () {
              togglePopups();
            });

            // Create popup
            function handleMapClick(e) {
              var popupss = L.popup();

              var latlng = e.latlng;

              var identifyResultGHIs = geoblaze.identify(georaster, [latlng.lng, latlng.lat]);
              var GHIValues = (identifyResultGHIs / 1000) * 1000;

              popupss
                .setLatLng(latlng)
                .setContent("GHI: " + GHIValues.toFixed(2) + " kWh/mÂ²")
                .openOn(map);
            }


            function togglePopups() {
              if (GHIValuesLayer) {
                if (map.hasLayer(GHIValuesLayer)) {
                  map.removeLayer(GHIValuesLayer);
                  map.off('click', handleMapClick);
                } else {
                  map.addLayer(GHIValuesLayer);
                  map.on('click', handleMapClick);
                }
              }
            }

          });
        });

      // Display the Wind Map with identify function
      map.createPane('WSValues');
      map.getPane('WSValues').style.zIndex = 102;

      var url_to_geotiff_WS_files = "https://czrxstrd4.github.io/avemn/WS.tif";

      var WSValuesLayer; // Declare WSValuesLayer variable

      fetch(url_to_geotiff_WS_files)
        .then(response => response.arrayBuffer())
        .then(arrayBuffer => {
          parseGeoraster(arrayBuffer).then(georaster => {

            const min = georaster.mins[0];
            const max = georaster.maxs[0];
            const range = georaster.ranges[0];

            console.log("max:", max);
            console.log("min:", min);
            console.log("range:", range);

            var scale = chroma.scale("YlGnBu");

            WSValuesLayer = new GeoRasterLayer({
              georaster: georaster,
              opacity: 0.6,
              resolution: 80,
              pane: 'WSValues',
              pixelValuesToColorFn: function (pixelValues) {
                var pixelValue = pixelValues[0];
                if (pixelValue === 0) return null;
                var scaledPixelValue = (pixelValue - min) / range;
                var color = scale(scaledPixelValue).hex();
                return color;
              }
            });

            // Toggle popups based on checkbox state
            var WStoggleCheckbox = document.getElementById('WStoggleCheckbox');
            WStoggleCheckbox.addEventListener('change', function () {
              togglePopups();
            });

            // Create popup
            function handleMapClick(e) {
              var popupss = L.popup();
              var latlng = e.latlng;
              var identifyResultWSs = geoblaze.identify(georaster, [latlng.lng, latlng.lat]);
              var WSValues = (identifyResultWSs / 1000) * 1000;

              if (WSValues > 0) {
                popupss
                  .setLatLng(latlng)
                  .setContent("Wind Speed: " + WSValues.toFixed(2) + " m/s")
                  .openOn(map);
              } else {
                popupss
                  .setLatLng(latlng)
                  .setContent("Wind Speed: NaN m/s")
                  .openOn(map);
              }
            }

            function togglePopups() {
              if (WSValuesLayer) {
                if (map.hasLayer(WSValuesLayer)) {
                  map.removeLayer(WSValuesLayer);
                  map.off('click', handleMapClick);
                } else {
                  map.addLayer(WSValuesLayer);
                  map.on('click', handleMapClick);
                }
              }
            }
          });
        });

      // Display the Slope Map with identify function
      map.createPane('SLPValues');
      map.getPane('SLPValues').style.zIndex = 103;

      var url_to_geotiff_SLP_files = "https://czrxstrd4.github.io/avemn/SLP.tif";

      var SLPValuesLayer; // Declare WSValuesLayer variable

      fetch(url_to_geotiff_SLP_files)
        .then(response => response.arrayBuffer())
        .then(arrayBuffer => {
          parseGeoraster(arrayBuffer).then(georaster => {
            const min = georaster.mins[0];
            const max = georaster.maxs[0];
            const range = georaster.ranges[0];

            var scale = chroma.scale("YlGnBu");

            SLPValuesLayer = new GeoRasterLayer({
              georaster: georaster,
              opacity: 0.8,
              resolution: 80,
              pane: 'SLPValues',
              pixelValuesToColorFn: function (pixelValues) {
                var pixelValue = pixelValues[0];
                if (pixelValue === 0) return "none"; // Return "none" for transparent color

                var maxSlope = 45; // Maximum slope value
                var minColor = chroma('#fdf0d5'); // Color for lower slope values
                var maxColor = chroma('#780000'); // Color for higher slope values

                // Calculate the color based on the slope value
                var color = chroma.mix(minColor, maxColor, pixelValue / maxSlope).hex();

                return color;
              }
            });

            // Toggle popups based on checkbox state
            var SLPtoggleCheckbox = document.getElementById('SLPtoggleCheckbox');
            SLPtoggleCheckbox.addEventListener('change', function () {
              togglePopups();
            });


            // Create popup
            function handleMapClick(e) {
              var popupss = L.popup();
              var latlng = e.latlng;
              var identifyResultSLPs = geoblaze.identify(georaster, [latlng.lng, latlng.lat]);
              var SLPValues = (identifyResultSLPs / 1000) * 1000;

              if (SLPValues > 0) {
                popupss
                  .setLatLng(latlng)
                  .setContent("Slope: " + SLPValues.toFixed(2) + " %")
                  .openOn(map);
              } else {
                popupss
                  .setLatLng(latlng)
                  .setContent("Slope: NaN m/s")
                  .openOn(map);
              }
            }

            function togglePopups() {
              if (SLPValuesLayer) {
                if (map.hasLayer(SLPValuesLayer)) {
                  map.removeLayer(SLPValuesLayer);
                  map.off('click', handleMapClick);
                } else {
                  map.addLayer(SLPValuesLayer);
                  map.on('click', handleMapClick);
                }
              }
            }
          });
        });


      // End of create map layer for GHI & WS

      var coordinates = [];

      var loadingPrompt = document.getElementById('loading-prompt');
      let FldSumstat;
      var FldClass;

      function runSequentially() {
        var codeBlocks = [{
            code: function () {

              var fileInput = document.getElementById('fileInput');
              var file = fileInput.files[0];
              var reader = new FileReader();
              reader.onload = function (e) {
                var fileContent = e.target.result;
                var geojson = JSON.parse(fileContent);
                coordinates = extractCoordinates(geojson);
              };
              reader.readAsText(file);
              loadingPrompt.style.display = 'block';

              function extractCoordinates(geojson) {
                var coordinates = [];
                if (geojson && geojson.features) {
                  geojson.features.forEach(function (feature) {
                    if (feature.geometry && feature.geometry.coordinates) {
                      coordinates.push(feature.geometry.coordinates);
                    }
                  });
                }
                return coordinates;
              };

            },
            delay: 1000 // Delay for code block 1 in milliseconds
          },
          {
            code: function () {

              // Calculate GHI Statistics

              var url_to_geotiff_GHI_file = "https://czrxstrd4.github.io/avemn/GHI.tif";
              fetch(url_to_geotiff_GHI_file)
                .then(response => response.arrayBuffer())
                .then(arrayBuffer => {
                  parseGeoraster(arrayBuffer).then(georaster => {

                    const meanss = geoblaze.mean(georaster, coordinates);
                    const mn = Number(meanss).toFixed(2);

                    var statisticsDiv = document.getElementById('GHIstatisticss');
                    statisticsDiv.textContent = 'Mean: ' + mn + ' kWh/mÂ²';

                    georaster = null;

                  });
                });

            },
            delay: 2000 // Delay for code block 2 in milliseconds
          },
          {
            code: function () {
              // Calculate Wind Speed Statistics

              var url_to_geotiff_WS_file = "https://czrxstrd4.github.io/avemn/WS.tif";
              fetch(url_to_geotiff_WS_file)
                .then(response => response.arrayBuffer())
                .then(arrayBuffer => {
                  parseGeoraster(arrayBuffer).then(georaster => {

                    const meanss = geoblaze.mean(georaster, coordinates);
                    const mn = Number(meanss).toFixed(2);

                    var statisticsDiv = document.getElementById('WSstatisticss');
                    statisticsDiv.textContent = 'Mean: ' + mn + ' m/s';

                    georaster = null;

                  });
                });
            },
            delay: 2000 // Delay for code block 3 in milliseconds
          },
          {
            code: function () {

              var url_to_geotiff_SLP_file = "https://czrxstrd4.github.io/avemn/SLP.tif";
              fetch(url_to_geotiff_SLP_file)
                .then(response => response.arrayBuffer())
                .then(arrayBuffer => {
                  parseGeoraster(arrayBuffer).then(georaster => {

                    const meanss = geoblaze.mean(georaster, coordinates);
                    const mn = Number(meanss).toFixed(2);

                    var statisticsDiv = document.getElementById('SLPstatisticss');
                    statisticsDiv.textContent = 'Mean: ' + mn + '%';

                    georaster = null;

                  });
                });



            },
            delay: 5000 // Delay for code block 3 in milliseconds
          },
          {
            code: function () {

              // Calculate Slope Histogram

              var url_to_geotiff_SLP_file = "https://czrxstrd4.github.io/avemn/SLPClass.tif";

              fetch(url_to_geotiff_SLP_file)
                .then(response => response.arrayBuffer())
                .then(arrayBuffer => {
                  parseGeoraster(arrayBuffer).then(georaster => {


                    const SLPHisto = geoblaze.histogram(georaster, coordinates, {
                      scaleType: "nominal"
                    });
                    console.log(SLPHisto);


                    const histogramData = geoblaze.histogram(georaster,
                      coordinates, {
                        scaleType: "nominal"
                      });

                    if (Array.isArray(histogramData) && histogramData.length > 0) {
                      // Access the first (and only) object in the array
                      const histogramValues = Object.values(histogramData[0]);

                      // Calculate the total sum of data
                      const sum = histogramValues.reduce((total, value) => total +
                        value, 0);

                      // Calculate the percentage of each data point
                      const percentages = histogramValues.map(value => ((value /
                        sum) * 100).toFixed(2));

                      // Assign custom labels based on the actual labels

                      const customLabels = Object.keys(histogramData[0]).map(
                        key => {
                          if (key === "1") {
                            return "Level";
                          } else if (key === "2") {
                            return "Level to Undulating";
                          } else if (key === "3") {
                            return "Undulating to Rolling";
                          } else if (key === "4") {
                            return "Rolling to Hilly";
                          } else if (key === "5") {
                            return "Hilly to Mountainous";
                          } else if (key === "6") {
                            return "Mountainous";
                          } else {
                            return `Label ${key}`;
                          }
                        });

                      // Create the histogram chart
                      var ctx = document.getElementById('histogramChart')
                        .getContext('2d');
                      var histogramChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                          labels: customLabels,
                          datasets: [{
                            label: 'Histogram',
                            data: histogramValues,
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                          }]
                        },
                        options: {
                          plugins: {
                            tooltip: {
                              callbacks: {
                                label: function (context) {
                                  // Retrieve the original data point
                                  const originalValue =
                                    context.parsed.y;

                                  // Calculate the multiplied value
                                  const multipliedValue =
                                    Number(
                                      originalValue *
                                      4.015).toFixed(
                                      2);

                                  // Retrieve the percentage
                                  const percentage =
                                    percentages[context
                                      .dataIndex];

                                  // Return the label string for the tooltip
                                  return `Value: ${multipliedValue}, Percentage: ${percentage}%`;
                                }
                              }
                            }
                          },
                          scales: {
                            x: {
                              beginAtZero: true
                            },
                            y: {
                              beginAtZero: true,
                              title: {
                                display: true,
                                text: 'Hectares',
                                font: {
                                  size: 14
                                }
                              },

                              ticks: {
                                callback: function (value) {
                                  return (value * 4.015)
                                    .toFixed(0);
                                }
                              }

                            }
                          }
                        }
                      });
                    } else {
                      console.error("Invalid data for histogram");
                    }
                    georaster = null;

                  });
                });
            },
            delay: 1000 // Delay for code block 2 in milliseconds
          },
          {
            //Azimuth Score
            code: function () {

              var url_to_geotiff_Azmt_file = "https://czrxstrd4.github.io/avemn/Azmt.tif";

              fetch(url_to_geotiff_Azmt_file)
                .then(response => response.arrayBuffer())
                .then(arrayBuffer => {
                  parseGeoraster(arrayBuffer).then(georaster => {

                    const meanss = geoblaze.mean(georaster, coordinates);
                    const mn = Number(meanss).toFixed(2);
                    let notes;

                    if ((mn >= 0 && mn <= 22.5) || (mn >= 337.51 && mn <= 360)) {
                      notes = "North, " + mn + "Â°";
                    } else if (mn >= 22.51 && mn <= 67.5) {
                      notes = "NorthEast, " + mn + "Â°";
                    } else if (mn >= 67.51 && mn <= 112.5) {
                      notes = "East, " + mn + "Â°";
                    } else if (mn >= 112.51 && mn <= 157.5) {
                      notes = "SouthEast, " + mn + "Â°";
                    } else if (mn >= 157.51 && mn <= 202.5) {
                      notes = "South, " + mn + "Â°";
                    } else if (mn >= 202.51 && mn <= 247.5) {
                      notes = "SouthWest, " + mn + "Â°";
                    } else if (mn >= 247.51 && mn <= 292.5) {
                      notes = "West, " + mn + "Â°";
                    } else if (mn >= 292.51 && mn <= 337.5) {
                      notes = "NorthWest, " + mn + "Â°";
                    } else {
                      notes = "N/A";
                    }
                    document.getElementById("Azmtstatisticss").innerHTML = notes;
                    georaster = null;
                  });
                });
            },
            delay: 5000 // Delay for code block 3 in milliseconds
          },
          {
            code: function () {
              // Calculate Service Contract Statistics

              var url_to_geotiff_SC_file = "https://czrxstrd4.github.io/avemn/SC.tif";

              fetch(url_to_geotiff_SC_file)
                .then(response => response.arrayBuffer())
                .then(arrayBuffer => {
                  parseGeoraster(arrayBuffer).then(georaster => {

                    const meanss = geoblaze.mean(georaster, coordinates);
                    const mn = (Number(meanss) * 100).toFixed(2);
                    let notes;
                    let fontColor;

                    if (mn > 0) {
                      notes =
                        "With Potential Overlap. Contact the Owner/Broker/DOE to confirm. Overlap at ~" +
                        mn + "%";
                      fontColor = "red";
                    } else {

                      notes = "No potential overlap.";
                      fontColor = "green";
                    }
                    document.getElementById("SCstatisticss").innerHTML = notes;
                    document.getElementById("SCstatisticss").style.color =
                      fontColor;
                    georaster = null;

                  });
                });


            },
            delay: 5000 // Delay for code block 3 in milliseconds
          },
          {
            code: function () {
              // Calculate Ancestral Domain Statistics

              var url_to_geotiff_AD_file = "https://czrxstrd4.github.io/avemn/AncstrlD.tif";
              fetch(url_to_geotiff_AD_file)
                .then(response => response.arrayBuffer())
                .then(arrayBuffer => {
                  parseGeoraster(arrayBuffer).then(georaster => {

                    const meanss = geoblaze.mean(georaster, coordinates);
                    const mn = (Number(meanss) * 100).toFixed(2);
                    let notes;
                    let fontColor;


                    if (mn > 0) {

                      notes =
                        "With Potential Overlap. Contact the Owner/Broker/LGU/NCIP to confirm. Overlap at ~" +
                        mn + "%";
                      fontColor = "red";
                    } else {

                      notes = "No potential overlap.";
                      fontColor = "green";
                    }

                    document.getElementById("ADstatisticss").innerHTML = notes;
                    document.getElementById("ADstatisticss").style.color =
                      fontColor;

                    georaster = null;

                  });
                });
            },
            delay: 3000 // Delay for code block 2 in milliseconds
          },
          {
            code: function () {
              // Calculate Irrigation Statistics

              var url_to_geotiff_Irgtn_file = "https://czrxstrd4.github.io/avemn/Irrgtn.tif";


              fetch(url_to_geotiff_Irgtn_file)
                .then(response => response.arrayBuffer())
                .then(arrayBuffer => {
                  parseGeoraster(arrayBuffer).then(georaster => {

                    const meanss = geoblaze.mean(georaster, coordinates);
                    const mn = (Number(meanss) * 100).toFixed(2);
                    let notes;
                    let fontColor;

                    if (mn > 0) {

                      notes =
                        "With Potential Overlap. Contact the Owner/Broker/LGU/NIA to confirm. Overlap at ~" +
                        mn + "%";
                      fontColor = "red";
                    } else {

                      notes = "No potential overlap.";
                      fontColor = "green";
                    }
                    document.getElementById("Irgtnstatisticss").innerHTML = notes;
                    document.getElementById("Irgtnstatisticss").style.color =
                      fontColor;
                    georaster = null;

                  });
                });
            },
            delay: 2000 // Delay for code block 2 in milliseconds
          },
          {
            code: function () {
              // Calculate Protected Area Statistics

              var url_to_geotiff_PrtdArs_file = "https://czrxstrd4.github.io/avemn/PrtdArs.tif";

              fetch(url_to_geotiff_PrtdArs_file)
                .then(response => response.arrayBuffer())
                .then(arrayBuffer => {
                  parseGeoraster(arrayBuffer).then(georaster => {

                    const meanss = geoblaze.mean(georaster, coordinates);
                    const mn = (Number(meanss) * 100).toFixed(2);
                    console.log("Mean:", meanss);
                    let notes;
                    let fontColor;

                    if (mn > 0) {

                      notes =
                        "With Potential Overlap. Contact the Owner/Broker/LGU/DENR to confirm. Overlap at ~" +
                        mn + "%";
                      fontColor = "red";
                    } else {

                      notes = "No potential overlap.";
                      fontColor = "green";
                    }

                    document.getElementById("PrtdArsstatisticss").innerHTML = notes;
                    document.getElementById("PrtdArsstatisticss").style.color =
                      fontColor;
                    georaster = null;

                  });
                });
            },
            delay: 3000 // Delay for code block 2 in milliseconds
          },
          {
            code: function () {

              // Calculate Active Fault Statistics

              var url_to_geotiff_Flt_file = "https://czrxstrd4.github.io/avemn/Flt.tif";
              fetch(url_to_geotiff_Flt_file)
                .then(response => response.arrayBuffer())
                .then(arrayBuffer => {
                  parseGeoraster(arrayBuffer).then(georaster => {

                    const meanss = geoblaze.mean(georaster, coordinates);
                    const mn = (Number(meanss) * 100).toFixed(2);
                    console.log("Mean:", meanss);
                    let notes;
                    let fontColor;

                    if (mn > 0) {

                      notes =
                        "With Potential Overlap. Check the maps or contact PHILVOCS to confirm.";
                      fontColor = "red";
                    } else {

                      notes = "No potential overlap.";
                      fontColor = "green";
                    }

                    document.getElementById("Fltstatisticss").innerHTML = notes;
                    document.getElementById("Fltstatisticss").style.color =
                      fontColor;


                    georaster = null;

                  });
                });
            },
            delay: 2000 // Delay for code block 3 in milliseconds
          },
          {
            code: function () {

              // Calculate Flood Hazard Classified Statistics

              var url_to_geotiff_Fld_file = "https://czrxstrd4.github.io/avemn/Fld.tif";

              fetch(url_to_geotiff_Fld_file)
                .then(response => response.arrayBuffer())
                .then(arrayBuffer => {
                  parseGeoraster(arrayBuffer).then(georaster => {
                    const meanss = geoblaze.mean(georaster, coordinates);
                    const mn = (Number(meanss) * 100).toFixed(2);

                    const sumss = geoblaze.sum(georaster, coordinates);
                    FldSumstat = (Number(sumss)).toFixed(2);
                    georaster = null;

                  });
                });
            },
            delay: 3000 // Delay for code block 2 in milliseconds
          },
          {
            code: function () {


              // Calculate Flood Hazard Binary Statistics
              var url_to_geotiff_FldBi_file = "https://czrxstrd4.github.io/avemn/FldBi.tif";
              let FldBiSumstat;

              fetch(url_to_geotiff_FldBi_file)
                .then(response => response.arrayBuffer())
                .then(arrayBuffer => {
                  parseGeoraster(arrayBuffer).then(georaster => {

                    const meanss = geoblaze.mean(georaster, coordinates);
                    const mn = (Number(meanss) * 100).toFixed(2);

                    const sumss = geoblaze.sum(georaster, coordinates);

                    let notes;
                    let fontColor;

                    if (mn > 0) {


                      if ((FldSumstat / ((Number(sumss)).toFixed(2))) < 1.67) {

                        notes = "Overlap at ~" + mn +
                          "%, & Susceptibility Level at Low Susceptibility. Check the maps and Contact the Owner/Broker/LGU to confirm.";
                        fontColor = "red";
                      } else if ((FldSumstat / ((Number(sumss)).toFixed(2))) >=
                        1.67 && (FldSumstat / ((Number(sumss)).toFixed(2))) <=
                        2.33) {
                        notes = "Overlap at ~" + mn +
                          "%, & Susceptibility Level at Medium Susceptibility. Check the maps and Contact the Owner/Broker/LGU to confirm.";
                        fontColor = "red";
                      } else if ((FldSumstat / ((Number(sumss)).toFixed(2))) >
                        2.33) {
                        notes = "Overlap at ~" + mn +
                          "%, & Susceptibility Level at High Susceptibility. Check the maps and Contact the Owner/Broker/LGU to confirm.";
                        fontColor = "red";
                      }


                    } else {

                      notes = "No potential overlap.";
                      fontColor = "green";
                    }


                    document.getElementById("FldBistatisticss").innerHTML = notes;
                    document.getElementById("FldBistatisticss").style.color =
                      fontColor;


                    georaster = null;

                  });
                });
            },
            delay: 3000 // Delay for code block 3 in milliseconds
          },

          {
            code: function () {
              loadingPrompt.style.display = 'none';
            },
            delay: 1000 // Delay for code block 2 in milliseconds
          }
        ];

        document.getElementById('fetchButton').addEventListener('click', function () {
          var index = 0;

          function executeNext() {
            if (index < codeBlocks.length) {
              var codeBlock = codeBlocks[index];
              codeBlock.code(); // Execute the code block

              index++;
              setTimeout(executeNext, codeBlock.delay); // Delay before executing the next code block
            }
          }

          executeNext();
        });
      }
    </script>
</body>

</html>